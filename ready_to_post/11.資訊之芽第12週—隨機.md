# è³‡è¨Šä¹‹èŠ½ç¬¬12é€±â€”éš¨æ©Ÿ
###### tags: `è³‡è¨Šä¹‹èŠ½`

## ä¸Šèª²å…§å®¹
é€™ä¸€é€±è¬›éš¨æ©Ÿï¼Œä¸»è¦è¬›rolling hashï¼Œå­—ä¸²çš„hashã€éš¨æ©Ÿçš„ä¾‹é¡Œï¼Œåƒæ˜¯çŸ©é™£ä¹˜æ³•çš„é©—è­‰$O(n^2)$ã€è¨ªå•å€é–“å„å…ƒç´ å‡ºç¾æ¬¡æ•¸æ˜¯å¦ç‚ºkçš„å€æ•¸ï¼Œæœ€è¿‘é»å°çš„$O(n)$ä½œæ³•ç­‰ï¼ˆé‚„æœ‰æ±è¥¿é‚„æ²’æœ‰çœ‹XDï¼‰

## ä¸Šæ©Ÿä½œæ¥­
### æ¬¸è¿ªçš„å­—ä¸²
[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/265/)
è¼¸å…¥æœ‰å…©è¡Œï¼Œç¬¬ä¸€è¡ŒåŒ…å«ä¸€å€‹é•·åº¦ä»‹æ–¼[1,500000]çš„å­—ä¸²Sï¼Œç¬¬äºŒè¡ŒåŒ…å«ä¸€å€‹é•·åº¦ä»‹æ–¼[1,500000]çš„å­—ä¸²Tï¼Œè«‹è¼¸å‡ºä¸€ä¸²éå¢çš„æ•¸åˆ—è¡¨ç¤ºå­—ä¸²Så‡ºç¾åœ¨å­—ä¸²Tçš„å“ªäº›åœ°æ–¹ã€‚

**Rolling hash**ï¼š
$$H(s[1:n]) = \sum_{i=0}^n S_i\times C^{n-i}$$
æˆ‘å€‘å¦‚æœå‡è¨­æˆ‘å€‘è¦æ‰¾çš„ç›®æ¨™å­—ä¸²Sï¼Œé•·åº¦ç‚ºmï¼Œä»–çš„é›œæ¹Šå€¼æ˜¯ï¼š
$$H(S)= \sum_{i=1}^mS_i \times C^{m-i}$$
å‰‡å°æ–¼é•·åº¦ç‚ºLèˆ‡r-1çš„å­—ä¸²Tï¼Œå…¶hashå€¼ç‚ºï¼š
$$H(T[1:L]) = \sum_{i=1}^LT_i\times C^{L-i}$$
$$H(T[1:r-1]) = \sum_{i=1}^{r-1}T_i\times C^{r-1-i}$$
å‰‡ç›®æ¨™å€é–“é•·åº¦ç‚ºmçš„å­—ä¸²é•·åº¦å³ç‚ºå­—ä¸²Sçš„é›œæ¹Šå€¼ï¼Œå°‡T[1:L]çš„é›œæ¹Šå€¼æ‰£æ‰$C^{m}$ä¹˜ä¸ŠT[1:r-1]çš„é›œæ¹Šå€¼ï¼Œå³ç‚ºæ‰€æ±‚ã€‚



$$\begin{split}H(S)&=H(T[r:L])\\ &=H(T[1:L])-H(T[1:r-1])\\
&= \sum_{i=1}^LT_i\times C^{L-i} - C^{m}\times \sum_{i=1}^{r-1}T_i\times C^{r-1-i} \\
&=\sum_{i=1}^LT_i\times C^{L-i}-\sum_{i=1}^{r-1}T_i\times C^{L-i} \\
&= \sum_{i=r}^{L}T_i\times C^{L-i} \\
&= \sum_{i=1}^{m}T_{i+r-1}\times C^{m-1}\end{split}$$
å°±å¯ä»¥å¾—åˆ°ç•¶å‰å€é–“çš„hashå€¼
æ‰€ä»¥é€™æ•´é¡Œå°±è®Šæˆç¶­è­·å­—ä¸²Tçš„å‰ç¶´å’Œï¼Œé€éä»¥ä¸Šæ–¹å¼O(n)å¾—åˆ°æ¯ä¸€å€‹indexçš„hashå€¼ï¼Œæ¥è‘—O(1)æ¯”å°å³å¯ã€‚
:::success
Q:ç…§æœ€åŸºæœ¬çš„æš´åŠ›æ¯”å°å¯ä¸å¯è¡Œï¼Ÿ
A:å¯ä»¥æ§‹é€ å‡ºéœ€è¦æ¯”å°å¾ˆå¤šæ¬¡çš„å­—ä¸²ï¼Œæœ‰å¯èƒ½æœƒè¢«å¡TLEä¹‹é¡çš„![](https://i.imgur.com/02iE9me.png)
:::
ä»¥å¾Œä¸€å®šè¦è¨˜å¾—ï¼Œå¿…é ˆè¦è¡Œæœ«**è¼¸å‡ºä¸€è¡Œ**ï¼Œæˆ‘åœ¨é€™é‚ŠWAè¶…ä¹…
```cpp=
#include <bits/stdc++.h>
#define int unsigned long long int
#define INF 0x3f3f3f3f
#define N 500005
#define mod 1000000007
using namespace std;
int power[N],hash_func[N],charc[30],n,m,C = 137;
char target[N],a[N];
vector<int> vec;

void init(){
    power[0] = 1;
    srand(time(NULL));
    for(int i=1;i<=m;i++){
        power[i] = ((power[i-1]*C)+mod)%mod;
    }
    for(int i=0;i<30;i++){    //å†ç”¨randä¾†ä½¿å­—ä¸²æ›´äº‚ï¼ˆä¸ç”¨ä¹Ÿæ²’å·®ï¼‰
        int temp = rand();
        charc[i] = temp;
    }
}
signed main(){
    scanf("%s\n%s",target+1,a+1);
    m = strlen(target+1);
    n = strlen(a+1);
    init();
    hash_func[0] = 0;
    
    for(int i=1;i<=n;i++){
        hash_func[i] = ((C*hash_func[i-1]+(charc[a[i]-'a']))+mod)%mod;
    }
    int sum = 0;
    for(int i=1;i<=m;i++){
        sum = ((sum*C+(charc[target[i]-'a']))+mod)%mod;
    }
    for(int i=0;i<=n-m;i++){
        if(sum == ((hash_func[i+m]-((hash_func[i]*power[m])+mod)%mod)+mod)%mod)
            vec.push_back(i);
    }
    int len = vec.size();
    
    if(len>0)printf("%llu",vec[0]);
    for(int i=1;i<len;i++){
        printf(" %llu",vec[i]);
    }
    cout<<endl;    //é€™ä¸€è¡Œæ˜¯æ¯’ç˜¤
}
```

### æº«åŠ›çš„æ•…äº‹
[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/266/)
çµ¦å­—ä¸²é›†åˆAï¼Œæ¥ä¸‹ä¾†çµ¦må€‹å­—ä¸²ï¼Œå•ä½ åœ¨må€‹å­—ä¸²ä¸­iå­—ä¸²ä¸€å…±å‡ºç¾äº†å¹¾æ¬¡ã€‚
ç›´è¦ºçš„æƒ³æ³•å°±æ˜¯ç›´æ¥ç”¨multisetä¾†è§£é€™ä¸€é¡Œã€‚
```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define int unsigned long long int
#define N 105
using namespace std;
int n,m,power[N],C = 13331;

void init(){
    power[0] = 1;
    for(int i=1;i<=N;i++){
        power[i] = power[i-1]*C;
    }
}

int func(string s){
    int len = s.size(),sum = 0;
    for(int i=1;i<=len;i++){
        sum+=((int)s[i-1]*power[len-i]);
    }
    return sum;
}

signed main(){
    ios;
    init();
    multiset<int> ss;
    cin>>n>>m;
    for(int i=0;i<n;i++){
        string s;cin>>s;
        int temp = func(s);
        ss.insert(temp);
    }
    for(int i=0;i<m;i++){
        string s;cin>>s;
        int temp = func(s);
        cout<<ss.count(temp)<<endl;
    }
}
```

### æƒ³ä¸åˆ°é¡Œç›®æ¨™é¡ŒQQ
[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/793/)
åœ–ä¸­çš„-2æ”¹æˆ-(k-1)ï¼Œå°æ–¼åœ–ä¸­çš„x,yéƒ½æ˜¯è¨­è¨ˆæˆå¤§æ•¸äº‚æ•¸ï¼Œè¦æ‰¿æ“”çš„é¢¨éšªå°±æ˜¯é€™äº›å¤§æ•¸ç›¸åŠ ä¹‹å¾Œä¸æ‡‰è©²è®Šæˆ0çš„å»è®Šæˆ0ï¼ˆæ©Ÿç‡è¶…å°ï¼‰
é‚„æœ‰ä¸€å€‹é‡é»ï¼Œå°æ–¼æ¯ä¸€ç­†è©¢å•éƒ½è¦æ±‚å‡ºå€é–“çš„å’Œï¼Œå› æ­¤è¦ç”¨O(n)ç¶­è­·å‰ç¶´å’Œï¼ï¼ˆä¸€é–‹å§‹æ²’æƒ³åˆ°tleï¼Œä¸ééˆå…‰ä¸€é–ƒç¶­è­·å‰ç¶´å’Œå°±éäº†ï¼‰
![](https://i.imgur.com/Z4NzA4J.png)
```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define int long long int
#define N 500005
#define mod 1000000007
using namespace std;
int n,k,m,arr[N],times[N],fuck[N],value[N],pre[N];

void init(){
    memset(times, 0, sizeof(times));
    srand(time(NULL));
    pre[0] = 0;
    for(int i=0;i<=N;i++){
        int temp = rand()%mod;
        fuck[i] = temp;
    }
}

signed main(){
    ios;
    init();
    cin>>n>>k>>m;
    for(int i=1;i<=n;i++){
        cin>>arr[i];
        times[arr[i]]++;
        if(times[arr[i]]%k==0){
            value[i] = -(k-1)*fuck[arr[i]];
        }
        else{
            value[i] = fuck[arr[i]];
        }
        pre[i] = (pre[i-1]+value[i]);
    }

    for(int i=1;i<=m;i++){
        int l,r,sum=0;cin>>l>>r;
        sum = pre[r]-pre[l-1];
        if(sum==0)cout<<1;
        else cout<<0;
    }
    cout<<endl;
}
```

### çŸ©é™£ä¹˜æ³•
[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/740/)
çµ¦å®šä¸‰å€‹çŸ©é™£ABCï¼Œé©—è­‰Aä¹˜ä¸ŠBæ˜¯å¦ç‚ºCã€‚
ç•¶ç„¶å¯ä»¥ç”¨$O(n^3)$çš„æ™‚é–“å¯¦éš›é©—è­‰Aä¹˜ä¸ŠBçš„çµæœèˆ‡Cæ¯”å°ï¼Œä½†å…¶å¯¦æœ‰æ›´å¿«çš„æ–¹æ³•
å¦‚ä¸‹ï¼Œæ§‹é€ å‡ºçŸ©é™£Rï¼Œé€™ä¸€é¡Œå¯ä»¥æ€è€ƒè¦1ä¹˜ä¸Šå¤šå°‘çš„çŸ©é™£ï¼Œé€éå…©æ¬¡O(n^2)çš„ä¹˜æ³•ï¼Œå°±å¯ä»¥æ¯”å°é€™å€‹RçŸ©é™£ä¹˜ä¸ŠCçŸ©é™£çš„çµæœ
é€™é¡Œè »ç°¡å–®çš„ï¼Œä¸€æ¬¡å°±éäº†
![](https://i.imgur.com/LvdbXi8.png)
```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define int long long int
#define N 1505
#define mod 1000000007
using namespace std;
int n,m,k,a[N][N],b[N][N],c[N][N],R[N],temp[N],c_new[N];

void init(){
    memset(temp, 0, sizeof(temp));
    srand(time(NULL));
    for(int i=0;i<N;i++){
        int temp = rand()%mod;
        R[i] = temp;
    }
}

void input(){
    cin>>n>>m>>k;
    for(int i=0;i<n;i++){
        for(int j=0;j<m;j++){
            cin>>a[i][j];
        }
    }
    for(int i=0;i<m;i++){
        for(int j=0;j<k;j++){
            cin>>b[i][j];
        }
    }
    for(int i=0;i<n;i++){
        for(int j=0;j<k;j++){
            cin>>c[i][j];
        }
    }
}

signed main(){
    ios;
    init();
    input();
    for(int i=0;i<m;i++){
        for(int j=0;j<k;j++){
            temp[i]+=(b[i][j]*R[j])%mod;
        }
    }
    for(int i=0;i<n;i++){
        for(int j=0;j<m;j++){
            c_new[i]+=(a[i][j]*temp[j])%mod;
        }
    }
    bool flag = 1;
    for(int i=0;i<n;i++){
        int sum = 0;
        for(int j=0;j<k;j++){
            sum+=(c[i][j]*R[j])%mod;
        }
        if(c_new[i]!=sum){
            flag = 0;
            break;
        }
    }
    if(flag)cout<<"Yes"<<endl;
    else cout<<"No"<<endl;
}
```

### æœ€è¿‘é»å°
[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/795/)
å¤§é­”ç‹é¡Œï¼Œå®³æˆ‘TLE 27æ¬¡ã€‚
äºŒç¶­å¹³é¢ï¼Œçµ¦å®šnå€‹é»ï¼Œæ±‚å‡ºæœ€è¿‘çš„å…©å€‹é»çš„è·é›¢ã€‚
é‡å¤§BUGå®³æˆ‘å¡ä¸‰å¤©çš„BUGåœ¨æ–¼ï¼Œé¡Œç›®è¦æ±‚è¼¸å‡ºè·é›¢çš„å¹³æ–¹ï¼Œçµæœåœ¨è¨ˆç®—éç¨‹ä¸­å°±ç›´æ¥æŠŠè·é›¢ç•¶ä½œæ˜¯å¹³æ–¹ï¼Œè‡ªç„¶æœ‰å¾ˆå¤šé»æœƒåŒæ™‚å‡ºç¾åœ¨ä¸€æ ¼ç¶²æ ¼åº§æ¨™ä¸­ï¼ˆæˆ‘å¼±ï¼Œä¸€ç›´TLEï¼‰ï¼Œé‚„ä¸€ç›´ç”¨ä»€éº¼multi_mapä¹‹é¡çš„ï¼Œç•¶ç„¶å°±æ˜¯TLEå˜ã€‚
æš´åŠ›åšï¼š$O(n^2)$ï¼Œåˆ†æ²»åšï¼š$O(nlogn)$ï¼Œéš¨æ©Ÿåšï¼šæœŸæœ›$O(n)$,æœ€æ…˜$O(n^2)$
é€™ä¸€é¡Œçš„æ­¥é©Ÿï¼š
1. æŠŠ N å€‹é»å¹³ç§»åˆ°ç¬¬ä¸€è±¡é™
2. æŠŠ N å€‹é»çš„é †åºéš¨æ©Ÿæ‰“äº‚ï¼Œd = dis(ğ‘1, ğ‘2)
3. ä»¥ ğ‘Ÿ = ğ‘‘/2 çš„å¤§å°å°‡äºŒç¶­å¹³é¢åˆ‡æˆç¶²æ ¼ç‹€ï¼Œä¸¦å°‡é€™äº›ç¶²æ ¼ä¹Ÿ ğ‘¥ğ‘¦
ä»¥åº§æ¨™è¡¨ç¤º:é»(ğ‘¥,ğ‘¦)æœƒè½å…¥åº§æ¨™ç‚º (ğ‘Ÿ,ğ‘Ÿ)
<font color="#f00">ä¸æœƒæœ‰å…©å€‹é»åœ¨åŒä¸€å€‹æ ¼å­å…§</font>ï¼ˆå¾ˆé‡è¦çš„æ€§è³ªï¼‰
4. ä¸€ç›´æŠŠé»åŠ é€²ç¶²æ ¼ä¸­
å¦‚æœç”¢ç”Ÿæ–°çš„æœ€è¿‘é»å°ä¸€å®šæœƒå‡ºç¾åœ¨ä»¥æŸå€‹é»ç‚ºä¸­å¿ƒçš„5Ã—5å®®æ ¼å…§
5. æ‰¾åˆ°æ›´è¿‘çš„æœ€è¿‘é»å°
æ›´æ–° r= æ–°çš„æœ€è¿‘é»å° /2 ï¼Œå›åˆ°æ­¥é©Ÿä¸‰é‡ä¾† O(i+1)

:::info
**æœŸæœ›è¤‡é›œåº¦ $O(n)$ è­‰æ˜**
![](https://i.imgur.com/S5dF8W7.png)

è€ƒæ…®åŠ å…¥ç¬¬i+1å€‹é»æ™‚å‡ºç¾æ–°çš„æœ€è¿‘é»å°ï¼Œç™¼ç”Ÿçš„æ©Ÿç‡ç‚ºï¼šåœ¨$C_2^{i+1}$å€‹é…å°ä¸­è·Ÿi+1å€‹é»ç”¢ç”Ÿæœ€è¿‘é»å°å…±æœ‰iç¨®å¯èƒ½ï¼Œå› æ­¤æ©Ÿç‡ç‚º$\frac{2}{i+1}$ï¼Œç•¶æ©Ÿç‡ç™¼ç”Ÿçš„æ™‚å€™ï¼Œå¿…é ˆå°‡æ‰€æœ‰çš„é»éƒ½åˆªæ‰é‡æ–°ä¾†ä¸€éï¼ˆå› ç‚ºrè®Šå°ï¼Œunordered_mapè£¡é¢çš„æ±è¥¿ä¹Ÿè¦è¢«æ¸…ç©ºï¼Œé‡æ–°æ¨å…¥i+1å€‹é»ï¼‰ï¼Œéœ€è¦ä»˜å‡º$O(i+1)$çš„æ™‚é–“ï¼Œç›¸ä¹˜èµ·ä¾†æ¯ä¸€å€‹é»æœŸæœ›çš„è¤‡é›œåº¦ç‚º$O(1)$ï¼Œå› æ­¤ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º$O(n)$ã€‚
:::

å¯¦ä½œä¸Šå¯ä»¥ç”¨unordered_mapï¼Œå› ç‚ºä¿è­‰ä¸æœƒå‡ºç¾åŒä¸€æ ¼çš„æƒ…æ³ï¼ˆä¸€æ ¼é–“çš„æœ€é•·è·é›¢ä¹Ÿå°±ä¸è¶…édï¼Œæ‰€ä»¥ç•¶å‡ºç¾åœ¨åŒä¸€æ ¼å°±è¡¨ç¤ºè©²æ›´æ–°äº†ï¼‰

å„ªåŒ–ï¼šå…ˆç”¨O(n^2)çš„ä½œæ³•ï¼Œæ‰¾åˆ°å‰é¢çš„å°‘æ•¸pairï¼ˆsqrt(n)ï¼‰çš„æœ€çŸ­è·é›¢ï¼Œé€™æ¨£å¯ä»¥æ¸›å°‘è¢«é‡æ–°æ›´æ–°çš„æ©Ÿæœƒ
![](https://i.imgur.com/9XfZNH9.png)

[é€™ç¯‡æ–‡ç« ](/N9zvIzP_Se-hpWZSaMv-sQ)æœ‰åˆ†æ²»çš„ä½œæ³•ï¼Œé›–ç„¶åˆ†æ²»çš„è¤‡é›œåº¦æ˜¯O(n\log n)ï¼Œéš¨æ©Ÿæ˜¯$O(n)$ï¼Œä½†å› ç‚ºéš¨æ©Ÿå¸¸æ•¸æ¯”è¼ƒå¤§çš„é—œä¿‚ï¼Œæ™‚é–“æ¯”åˆ†æ²»æ…¢äº†å¿«å…©å€ï¼ä¸‹åœ–æ˜¯åˆ†æ²»çš„åŸ·è¡Œçµæœï¼š
![](https://i.imgur.com/eCxfumY.png)

ä»¥ä¸‹æ˜¯éš¨æ©ŸAC Codeï¼š

```cpp=
#include <bits/stdc++.h>
#define int long long int
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define N 200005
#define INF 1000000000LL
#define swift 1000000000
using namespace std;
int n,ans;
double r,d;
int dx[25] = {-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,0,0,0,0,0,1,1,1,1,1,2,2,2,2,2};
int dy[25] = {-2,-1,0,1,2,-2,-1,0,1,2,-2,-1,0,1,2,-2,-1,0,1,2,-2,-1,0,1,2};
unordered_map<int, int> m;

void solve();
inline void init();
void solve();
bool insert(int,int,int);
inline double dis(int,int);
inline int Grid(int);

struct node{
    int x,y,ind;
}point[N];

//å‡½å¼å¯¦ä½œ
inline void init(){
    m.clear();
}

inline int Grid(int ind){ //inputç¶²æ ¼åº§æ¨™
    int x = point[ind].x/r;
    int y = point[ind].y/r;
    return x*INF+y;
}
inline int dist(node a,node b){
    int x = a.x-b.x,y = a.y-b.y;
    return (x*x+y*y);
}

inline double dis(node a,node b){
    int x = a.x-b.x,y = a.y-b.y;
    return sqrt(x*x+y*y);
}

void solve(){
    m.insert(make_pair(Grid(0),0));m.insert(make_pair(Grid(1),1));
    for(int ind = 2;ind < n;ind++){
        int x = point[ind].x/r,y = point[ind].y/r,better=0;
        for(int i=0;i<25;i++){
            int nx = x+dx[i],ny = y+dy[i];
            auto it = m.find(nx*INF+ny);
            if(it!=m.end()){
                double distance = dis(point[it->second],point[ind]);
                if(distance<d){
                    better = 1;
                    ans = dist(point[it->second],point[ind]);
                    d = distance;
                    r = d/2;
                }
            }
        }
        if(better){    //å‰é¢çš„æ ¼å­ç›´æ¥ç‘±å…¥
            m.clear();
            for(int i=0;i<=ind;i++)m.insert(make_pair(Grid(i),i));
        }
        else{
            m.insert(make_pair(Grid(ind), ind));
        }
    }
}

signed main(){
    ios;
    init();
    cin>>n;
    for(int i=0;i<n;i++){
        int x,y;cin>>x>>y;
        x+=swift;y+=swift;
        point[i].x = x;point[i].y = y;
    }
    random_shuffle(point, point+n);
    int smalln = sqrt(n);
    ans = dist(point[0],point[1]);
    d = dis(point[0], point[1]);
    for(int i=0;i<=smalln;i++){
        for(int j=i+1;j<=smalln;j++){
            d = min(d,dis(point[i], point[j]));
            ans = min(ans,dist(point[i],point[j]));
        }
    }
    r = d/2;
    solve();
    cout<<ans<<endl;
}
```

## æ‰‹å¯«ä½œæ¥­
ä¸ç”¨äº¤æ‰‹å¯«ä½œæ¥­ï¼ä¸éé‚„æ˜¯æœ‰ä¸€ä»½ã€Œæ¬£è³ç”¨ã€çš„ï¼Œè¬›Disjoint Set
