---
title: è³‡èŠ½9-13é€±ï¼šåœ–è«–ã€éš¨æ©Ÿã€æ ¹è™Ÿç®—æ³•
date: 2021-5-8
tags: 
    - è³‡èŠ½ç­†è¨˜
    - å‹•æ…‹è¦åŠƒ
    - DP
categories: è³‡è¨Šä¹‹èŠ½ç­†è¨˜
mathjax: true
#password: sprout2022
---

# è³‡èŠ½ç¬¬ä¹é€±ï¼šå‹•æ…‹è¦åŠƒï¼ˆä¸‰ï¼‰

## ä¸Šèª²å…§å®¹

é¦–å…ˆæ˜¯å½±ç‰‡çš„é‡é»æ•´ç†ï¼Œä¸»é¡Œæ˜¯DPå„ªåŒ–ï¼š

DPå„ªåŒ–

- çŸ©é™£å¿«é€Ÿå†ªå„ªåŒ–
  - è²»æ°æ•¸åˆ—ï¼šO(n)->O(logN)
  - DC
  - æŠŠå¾ˆå¤§çš„nåšçŸ©é™£å¿«é€Ÿå†ªé™åˆ°logN
<!--more-->
- ç‹€æ…‹å£“ç¸®
  - TSPæ—…è¡ŒéŠ·å”®å“¡å•é¡Œ
  - æ¬Šé‡æœ€å°çš„æ¼¢ç±³é “è¿´è·¯
  - æš´åŠ›åšï¼šnå€‹é»ã€n-1é»ã€...ã€1å€‹é»
  - æš´åŠ›è¤‡é›œåº¦ï¼šO(N!)
  - ä½¿ç”¨ä½å…ƒç´€éŒ„
  - DP[n][s]ç”¨sçš„äºŒé€²ä½ç¬¬iä½è¡¨ç¤ºæ˜¯å¦å»éè©²åŸå¸‚
  - è¤‡é›œåº¦ï¼šè½‰ç§»$O(N)\times O(N\times 2^N)=O(n^2\times 2^n)$

- è³‡æ–™çµæ§‹å„ªåŒ–ï¼ˆå–®èª¿éšŠåˆ—å„ªåŒ–ï¼‰
  - é–‹ä¸€å€‹æ–°çš„dpMAXï¼ŒO(n^2)->O(n)
  - ä¸å¤§æ–¼Kï¼Œç”¨heapä¾†O(nlogn)ç¶­è­·éå¢çš„å›ºå®šå€é–“æœ€å¤§å€¼
  - æ–¹æ³•ä¸‰ï¼šç”¨Dequeå¯¦ä½œï¼ŒO(n)
  - I<jï¼Œdp[i]>dp[j] å…·æœ‰å–®èª¿æ€§ï¼ˆå–®èª¿éæ¸›ï¼‰

- å††å††é–‹åº—
  - dp[n] = val[n]+max(dp[i]-c(n-i)),n-kâ‰¤iâ‰¤n-1
  - O(NK)->O(N)ä½¿ç”¨å–®èª¿éšŠåˆ—å„ªåŒ–
  - ä»¤t[I] = dp[i]+c*i

- æœ‰é™èƒŒåŒ…å•é¡Œå„ªåŒ–
  - åˆ†æ¨æ¹Šå‡ºæ¯ä¸€ç¨®é‡é‡
  - å¦‚ä½•åˆ†æ¨ï¼šäºŒé€²ä½ ${1,2,4,8,...,2^p,q}$ï¼Œä½¿ $2^{p+1}-1$ ä¸å¤§æ–¼k[i]çš„æœ€å¤§æ•´æ•¸
  - åŸO(NWK) -> O(NW*logK)
  - åˆ©ç”¨å–®èª¿éšŠåˆ—å„ªåŒ–ï¼šO(NW)!!!

## ä¸Šæ©Ÿä½œæ¥­

### å††å††è³£æ¼¢å ¡

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/188/)
é¦–å…ˆåœ¨åšä»»ä½•å„ªåŒ–ä¹‹å‰ï¼Œéƒ½å¿…é ˆå…ˆåˆ—å‡ºå®šç¾©èˆ‡è½‰ç§»å¼ã€‚

#### å®šç¾©

å®šç¾©$dp[i]$ç‚ºåœ¨ç¬¬1åˆ°iå€‹é»é–‹åº—ï¼Œä¸”ç¬¬iå€‹é»æœ‰é–‹åº—æ™‚çš„æœ€å¤§ç›ˆåˆ©

#### è½‰ç§»å¼

$dp[i] = val[i]+max(dp[j]-c(i-j)),i-kâ‰¤jâ‰¤i-1$

#### é‚Šç•Œ

$dp[i] = 0, 1â‰¤iâ‰¤n$

åšå®Œä»¥ä¸Šçš„å®šç¾©èˆ‡è½‰ç§»å¼ä¹‹å¾Œï¼Œå¯ä»¥å¾—åˆ°è¤‡é›œåº¦ï¼š$O(NK)$å°±å¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„çµæœï¼š
![](https://i.imgur.com/Z4OaqJJ.png)
è©¦è‘—åˆ©ç”¨**å–®èª¿éšŠåˆ—å„ªåŒ–**ï¼ŒæŠŠè¤‡é›œåº¦é™åˆ°$O(N)$
åˆ©ç”¨å–®èª¿éšŠåˆ—å¯ä»¥ç¢ºä¿æ‰€æœ‰çš„æ•¸å­—éƒ½åªæœƒè¢«pushèˆ‡popä¸€æ¬¡ï¼Œå› æ­¤ç¸½è¤‡é›œåº¦ç‚º$O(n)$
![](https://i.imgur.com/hn2Px6s.png)
å·®ä¸€å€‹Kæ™‚é–“å°±å·®å¾ˆå¤šï¼

å…·é«”çš„ä½œæ³•å¦‚ä¸‹ï¼Œå› ç‚ºæˆ‘å€‘è¦ç¶­è­·çš„å–®èª¿éšŠåˆ—çš„dpå¾Œé¢æœ‰ä¸€äº›æ±è¥¿ï¼Œå› æ­¤æˆ‘å€‘è¦åšä¸€äº›èª¿æ•´ï¼ŒæŠŠæœ‰içš„æå‡ºä¾†ï¼ˆä¸ç„¶ç•¶iä¸ä¸€æ¨£çš„æ™‚å€™å°±å¾ˆé›£è™•ç†ï¼‰

$$\begin{split}dp[i] &= val[i]+max(dp[j]-c(i-j)),i-kâ‰¤jâ‰¤i-1\\&=val[i]-ci+max(dp[j]+cj)\end{split}$$

é€™æ™‚å€™ä»¤ $t[j] = dp[j]+cj$ï¼Œå¯ä»¥æŠŠåŠ ä¸Š $cj$ æƒ³åƒæˆè·Ÿé ­çš„è·é›¢ï¼ˆè·Ÿç•¶å‰çš„ $-ci$ åˆåœ¨ä¸€èµ·å°±æ˜¯æˆ‘å€‘è¦çš„è·é›¢ï¼‰ï¼Œå‰‡ $max(t[j]),i-kâ‰¤jâ‰¤i-1$ å°±å¯ä»¥ä½¿ç”¨å–®èª¿éšŠåˆ—å„ªåŒ–ï¼

{% note info %}
**å–®èª¿éšŠåˆ—å„ªåŒ–**

å–®èª¿éšŠåˆ—å„ªåŒ–åç¨±çš„ç”±ä¾†æ˜¯å› ç‚ºç¶­è­·çš„å®¹å™¨å…·æœ‰å–®èª¿æ€§ï¼ˆåœ¨é€™è£¡ç”¨åˆ°çš„æ˜¯å–®èª¿éæ¸›ï¼‰ï¼Œé€™ä¸€æ¬¡å˜—è©¦çš„æ˜¯ç”¨deque<pair<int,int>>ä¾†å¯¦ä½œï¼Œç¬¬ä¸€ç¶­æ˜¯è£t[i]ï¼Œç¬¬äºŒç¶­æ˜¯è£iã€‚ä»¥ä¸‹æ˜¯å…·é«”çš„å¯¦ä½œæ­¥é©Ÿï¼š

1. å°‡å–®èª¿éšŠåˆ—ä¸­<font color="#f00">éæ™‚çš„</font>ï¼ˆä¹Ÿå°±æ˜¯è·é›¢å¤§æ–¼Kçš„ï¼‰popå‡ºä¾†ï¼Œè®“å®¹å™¨ä¸­çš„å…ƒç´ éƒ½æ˜¯å¯ä»¥è¢«å–åˆ°çš„ç‹€æ…‹
2. æ›´æ–° $dp[n]$ çš„å€¼ï¼Œåˆ©ç”¨å®¹å™¨æœ€å‰é¢çš„å…ƒç´ ï¼ˆå°±æ˜¯æœ€å¤§çš„byå–®èª¿æ€§ï¼‰ä¾†æ›´æ–°ã€‚è¦æ³¨æ„åˆ°ï¼Œå…ƒç´ æœ€å‰é¢å›ºç„¶æ˜¯æœ€å¤§ï¼Œä½†ä¹Ÿå¯èƒ½æœƒæ¯”ä»€éº¼éƒ½ä¸å–é‚„å·®ï¼Œè¦ç‰¹åˆ¥æ³¨æ„ï¼
3. å¾å®¹å™¨çš„å¾Œé¢æ›´æ–°ï¼ŒæŠŠå°æ–¼æ¥ä¸‹ä¾†è¦æ”¾å…¥çš„å€¼çš„å…ƒç´ éƒ½popå‡ºä¾†ï¼Œä»¥ç¶­æŒå–®èª¿éæ¸›çš„ç‰¹æ€§ï¼
4. å°‡ç•¶å‰çš„ $t[n]$ çµ¦pushé€²å»ï¼çµæŸï¼

å¦‚æœè¦ç¶­è­·dp[n]çš„å–®èª¿æ€§ï¼Œæœƒä¿è­‰è‹¥ $i<j$ï¼Œå‰‡ $dp[i]>dp[j]$ï¼›å› ç‚ºå¦‚æœ$dp[i]â‰¤dp[j]$ï¼Œé‚£ç¬¬iå€‹æ°¸é ä¸æœƒè¢«å–åˆ°ï¼ˆå› ç‚ºè¦æ±‚çš„å€é–“æ˜¯ä¸æ–·å¾€å¾Œçš„ï¼Œè‹¥ä¸€å€‹æ•¸å­—åœ¨å‰é¢åˆæ¯”å¾Œé¢çš„æ•¸å­—å°ï¼Œæ°¸é å°±ä¸æœƒè¢«å–åˆ°ï¼ï¼‰
{% endnote %}

ä»¥ä¸‹æ˜¯ç¨‹å¼ç¢¼çš„éƒ¨åˆ†ï¼Œå…¶ä¸­ç¬¬21åˆ°24è¡Œç‚ºå–®èª¿éšŠåˆ—å„ªåŒ–çš„éƒ¨åˆ†ï¼š

```cpp=
#include <bits/stdc++.h>
#define int ll
#define ll long long
#define mod 1000000007
#define FOR(i,n) for(int i=0;i<n;i++)
#define ios ios::sync_with_stdio(0)
using namespace std;
int t;

void solve(){
    int n,k,c,val[100005];cin>>n>>k>>c;
    for(int i=1;i<=n;i++)cin>>val[i];
    
    int dp[100005];
    memset(dp,0,sizeof(dp));
    deque<pair<int,int>> deq;
    
    deq.push_back(make_pair(val[1]+c,1));    //é€™å€‹å°ç´°ç¯€å·®é»æ²’æœ‰æ³¨æ„åˆ°ï¼Œè¦åŠ ä¸Šc
    dp[1] = val[1];
    for(int i=2;i<=n;i++){
        while(!deq.empty() && deq.front().second < i-k)deq.pop_front();
        dp[i] = val[i]-c*i+max(c*i,deq.front().first);
        while(!deq.empty() && deq.back().first <= dp[i]+c*i)deq.pop_back();
        deq.push_back(make_pair(dp[i]+c*i,i));
    }
    int ans = 0;
    for(int i=1;i<=n;i++)ans = max(ans,dp[i]);
    cout<<ans<<endl;
}

signed main(){
    ios;
    cin>>t;
    while(t--){
        solve();
    }
}
```

### é«˜æ£•æ«šè§€å…‰è¾²å ´ï¼šæ—…è¡ŒéŠ·å”®å“¡å•é¡ŒTSP

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/187/)
ç¬¬ä¸€æ¬¡å¯«**TSP**(Traveling Salesman Problem)ï¼Œé¡Œç›®æ•˜è¿°å¦‚ä¸‹ï¼š
> çµ¦å®šä¸€ç³»åˆ—åŸå¸‚å’Œæ¯å°åŸå¸‚ä¹‹é–“çš„è·é›¢ï¼Œæ±‚è§£å­˜å–æ¯ä¸€åº§åŸå¸‚ä¸€æ¬¡ä¸¦å›åˆ°èµ·å§‹åŸå¸‚çš„æœ€çŸ­è¿´è·¯ã€‚

é€™æ˜¯ä¸€å€‹å·²ç¶“è¢«è­‰æ˜$NP-Hard$ çš„å•é¡Œï¼Œæš´åŠ›ä½œæ³•æ˜¯è¦æª¢æŸ¥æ‰€æœ‰è·¯å¾‘çš„æƒ…æ³ï¼Œå› ç‚ºå…±æœ‰nå€‹é»ï¼Œæ¯ä¸€å€‹é»åˆé€£æ¥n-1å€‹é»ï¼Œç¹¼çºŒä¸‹å»ç¸½å…±æœƒæœ‰N!ç¨®æƒ…æ³ï¼Œå› æ­¤è¤‡é›œåº¦ç‚º$O(n!)$ã€‚
ç¸½å…±çš„é»æ•¸å…±æœ‰nå€‹ï¼Œæ ¹æ“šå¤šé‚Šå½¢çš„é‚Šæ•¸å…¬å¼å¯ä»¥çŸ¥é“ä¸€å…±æœ‰$\frac{n^2-n}{2}$æ¢é‚Šï¼Œæ¯ä¸€æ¢é‚Šéƒ½æœ‰å„è‡ªçš„è·é›¢ã€‚
å¦‚æœæ”¹ç”¨DPåšï¼Œæ™‚é–“è¤‡é›œåº¦å¯ä»¥å£“åˆ°æ™‚é–“è¤‡é›œåº¦$O(n^2\cdot2^n)$ï¼Œæ¯”$O(n!)$é‚„å„ªç§€ï¼é€™ä¸€é¡Œç”¨åˆ°çš„æ˜¯DPå„ªåŒ–ä¸­çš„<font color="#f00">ç‹€æ…‹å£“ç¸®</font>ï¼Œå…·é«”çš„å¯¦ä½œç´°ç¯€å¦‚ä¸‹ï¼š

{% note success %}

**ä½å…ƒé‹ç®—**
åœ¨é€™ä¸€é¡Œéœ€è¦ç”¨åˆ°ä½å…ƒé‹ç®—ï¼Œç”¨16å€‹bitè¡¨ç¤ºæ¯ä¸€å€‹é»æœ‰æ²’æœ‰è¢«èµ°è¨ªéã€‚ç”¨é€™æ¨£çš„è¡¨ç¤ºæ–¹æ³•å¯ä»¥è®“codeæ›´ç‚ºç¯€å„‰ï¼Œä¹Ÿå°±æ˜¯ç‹€æ…‹å£“ç¸®çš„æ¦‚å¿µã€‚

**å·¦ç§»é‹ç®—å­(<<)**
é€™ä¸€é¡Œæœƒä¸€ç›´åè¦†è¢«ç”¨åˆ°ï¼Œ1<<tä»£è¡¨æŠŠ1å¾€å·¦ç§»å‹•tå–®ä½ï¼Œç”¨10é€²ä½è¡¨ç¤ºå°±æ˜¯$2^t$ã€‚æ¯å¾€å·¦ç§»å‹•ä¸€æ ¼ï¼Œæ•¸å­—å°±æœƒè®ŠæˆåŸä¾†çš„å…©å€ï¼

**ç‹€æ…‹å£“ç¸®**
å°‡åé€²ä½æ•´æ•¸sä»¥äºŒé€²ä½è¡¨ç¤ºï¼Œæœƒå¾—åˆ°ä¸€ä¸²01å­—ä¸²ï¼Œå‡è¨­s=10ï¼Œå‰‡ $s = 1010_{(2)}$ã€‚ä»¥é€™é¡Œä¾†èªªï¼Œé€™æ¨£çš„å­—ä¸²æˆ‘å€‘å¯ä»¥ç”¨ä¾†è¡¨ç¤ºç¬¬4å’Œç¬¬2å€‹é»å·²ç¶“è¢«æ‹œè¨ªï¼Œè€Œç¬¬3è·Ÿç¬¬1å€‹é»é‚„æ²’æœ‰è¢«æ‹œè¨ªã€‚
{% endnote %}

#### å®šç¾©

å®šç¾© $dp[n][s]$ è¡¨ç¤ºç›®å‰åœ¨ç¬¬né»ä¸Šï¼Œsç‚ºèµ°éçš„é»ï¼ˆç‹€æ…‹å£“ç¸®ï¼‰çš„æœ€çŸ­è·é›¢

#### è½‰ç§»å¼

$dp[n][s] = min(dp[i][s-(1<<n)]+dis[i][n])$, for all i such that s&(1<<i)!=0

é€™å€‹è½‰ç§»å¼å¾ˆæœ‰æ„æ€ï¼Œå› ç‚ºsä»£è¡¨äº†æ¯ä¸€å€‹é»æ˜¯å¦æœ‰è¢«èµ°éï¼Œç•¶æˆ‘è¦æ›´æ–°dp[n][s]æ™‚ï¼Œæˆ‘è¦ç¢ºä¿æ­¤æ™‚çš„ç‹€æ…‹sä¸­çš„é»nå¿…é ˆç‚º1ã€‚åŒæ™‚ï¼Œå› ç‚º1<<iç”¨äºŒé€²ä½è¡¨ç¤ºåªæœ‰ç¬¬iä½æœƒæ˜¯1å…¶ä»–éƒ½æ˜¯0ï¼Œåšandé‹ç®—å°±çœ‹sçš„ç¬¬iä½æ±ºå®šçµæœã€‚

å°æ–¼æ¯ä¸€å€‹iå¿…é ˆç¢ºä¿ç¬¬ié»åœ¨ç‹€æ…‹sä¸­æœ‰è¢«é€ è¨ªï¼Œå› æ­¤æœ‰äº†å¾Œé¢çš„æ¢ä»¶ã€‚å¦å¤–è½‰ç§»å¼ä¸­çš„s-(1<<N)æ˜¯æŠŠç¬¬nå€‹é»å¾æœªé€ è¨ªçš„ç‹€æ…‹è½‰ç§»ã€‚

#### é‚Šç•Œ

$dp[0][1] = 0,\quad dp[i][j]= \infty$

è·é›¢çš„é è¨­ç‹€æ…‹ç‚ºç„¡é™å¤§ï¼Œç¬¬ä¸€å€‹é»çš„åˆå§‹ç‹€æ…‹æ˜¯æœ€çŸ­è·é›¢0

#### å¯¦ä½œå°ç´°ç¯€

**è¿´åœˆé †åº**
åœ¨è½‰ç§»çš„éç¨‹ä¸­ï¼Œè¿´åœˆçš„ç¬¬ä¸€å±¤å¿…é ˆæ˜¯ç‹€æ…‹ï¼Œç¬¬äºŒå±¤æ‰æ˜¯åŸå¸‚ã€‚å¦‚æœé¡›å€’éä¾†çš„è©±ï¼Œæœƒå°è‡´å‰é¢çš„åŸå¸‚åœ¨ç‹€æ…‹é‚„æ²’æœ‰è¢«æ›´æ–°çš„æ™‚å€™å°±å·²ç¶“å¤±å»äº†ä¹‹å¾Œè¢«æ›´æ–°çš„æ©Ÿæœƒï¼Œå› æ­¤åŸå¸‚çš„è¿´åœˆå¿…é ˆæ”¾åœ¨ç¬¬äºŒå±¤ï¼

**æ±‚ç­”æ¡ˆ**
å› ç‚ºæˆ‘å€‘è¦æ±‚çš„æ˜¯å›åˆ°åŸé»çš„æœ€çŸ­è·é›¢ï¼Œå› æ­¤åœ¨å…¨éƒ¨è½‰ç§»å®Œæˆä¹‹å¾Œï¼Œåˆ©ç”¨ä¸€å€‹è¿´åœˆæŠŠå›å»åŸé»çš„è·¯çš„è·é›¢åŠ ä¸Šå»ï¼Œæ±‚å¾—æœ€å°å€¼ã€‚

```cpp=
#include <bits/stdc++.h>
#define N 16
#define mod 1000000007
#define FOR(i,n) for(int i=0;i<n;i++)
#define ios ios::sync_with_stdio(0)
using namespace std;
int t;

void solve(){
    int n,dis[20][20];cin>>n;
    memset(dis,0,sizeof(dis));
    
    for(int i=0;i<n-1;i++){
        for(int j=i+1;j<n;j++){
            cin>>dis[i][j];
            dis[j][i] = dis[i][j];
        }
    }
    
    int dp[N][66000],m = 1<<n;
    memset(dp,0x3f3f3f3f,sizeof(dp));
    dp[0][1] = 0;   //å°‡0é»åˆ°è‡ªå·±çš„è·é›¢è¨­ç‚º1
    
    //O(n^2 2^n)
    for(int i=0;i<m;i++){            //iè¡¨ç¤º2^næ¯ä¸€ç¨®ç‹€æ…‹
        for(int j=0;j<n;j++){        //jè¡¨ç¤ºåŸå¸‚
            if(!(i&(1<<j)))continue; //jåŸå¸‚è¦æ˜¯è¢«é€ è¨ªéçš„ç‹€æ…‹
            for(int k=0;k<n;k++){    //å¯ä»¥åˆ°çš„æ‰€æœ‰é»ä¸­çš„ç‹€æ…‹
                if(i & 1<<k){        //ç¢ºä¿è½‰ç§»éå»çš„æœ‰è¢«é€ è¨ªé
                    dp[j][i] = min(dp[j][i],dp[k][i-(1<<j)]+dis[j][k]);
                }
            }
        }
    }
    int ans = INT_MAX;
    for(int i=0;i<n;i++)ans = min(ans,dp[i][m-1]+dis[i][0]);
    cout<<ans<<endl;
}

int main(){
    ios;
    cin>>t;
    while(t--){
        solve();
    }
}
```

### æ†¤æ€’çš„å°é³¥

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/255/)
[Submission](https://neoj.sprout.tw/challenge/177536/)
ç©æ†¤æ€’é³¥éŠæˆ²çš„æ¦‚å¿µï¼Œçµ¦å®šäºŒç¶­å¹³é¢ä¸Šnå€‹é»ä»£è¡¨nå€‹è±¬ï¼ˆçš†åœ¨ç¬¬ä¸€è±¡é™ï¼‰ï¼Œé€™æ™‚å€™å¯ä»¥å¾åŸé»(0,0)çš„ä½ç½®ç™¼å°„è»Œè·¡ç‚ºæ‹‹ç‰©ç·šçš„å°é³¥ï¼Œæ‰“åˆ°è±¬è±¬å¾Œä¸¦ä¸æœƒæ”¹è®Šé£›è¡Œçš„è»Œè·¡ï¼Œé¡Œç›®æƒ³è¦å•æœ€å°‘è¦ç™¼å°„å¹¾å€‹å°é³¥æ‰èƒ½å°„ä¸‹æ‰€æœ‰çš„è±¬è±¬ï¼Ÿ

> ç¯„ä¾‹æ¸¬è³‡
> 7
> 1 3
> 2 4
> 3 3
> 2 6
> 4 8
> 1 1
> 1 2

å¦‚æœç•«åœ¨åœ–ä¸Šå°±é•·é€™æ¨£ï¼š
![](https://i.imgur.com/cCEHouc.png)

å¦‚æœæŠŠæ‹‹ç‰©ç·šç•«å‡ºä¾†å°±åƒé€™æ¨£ï¼š
![](https://i.imgur.com/u63WTC6.png)

å› ç‚º$n\le24$ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“é€™ä¸€é¡Œå¯èƒ½åªèƒ½æŠŠæ‰€æœ‰æƒ…æ³éƒ½æƒä¸€éï¼ˆ~~æ‰ä¸æ˜¯å› ç‚ºå‰›å¥½è¬›ç‹€æ…‹å£“ç¸®XD~~ï¼‰

**ä½œæ³•1ï¼š** æ™‚é–“è¤‡é›œåº¦$O(n^2\cdot 2^n)$
æˆ‘å€‘å¯ä»¥åˆ©ç”¨ä¸€å€‹äºŒç¶­é™£åˆ—g[i][j]è¡¨ç¤ºç¶“éiè±¬å’Œjè±¬èˆ‡åŸé»æ‰€å½¢æˆçš„æ‹‹ç‰©ç·šæ‰€èƒ½ç¶“éçš„æ‰€æœ‰é»çš„ç‹€æ…‹ã€‚é€™æ¨£æˆ‘å€‘å¯ä»¥åˆ©ç”¨$O(n^3)$çš„æ™‚é–“å®Œæˆé è™•ç†ï¼ŒçŸ¥é“ä¸€æ¢ç”±iè±¬å’Œjè±¬å½¢æˆçš„æ‹‹ç‰©ç·šèƒ½ç¶“éçš„é»çš„ç‹€æ…‹ï¼ˆç”¨äºŒé€²ä½è¡¨ç¤ºï¼‰ï¼Œåœ¨dpè½‰ç§»çš„æ™‚å€™å‰‡éœ€æšèˆ‰æ‰€æœ‰çš„iå’Œjï¼Œæ‰€éœ€æ™‚é–“æ˜¯$n^2$ã€‚
è½‰ç§»å¼çš„è©±ä¸€é–‹å§‹æ˜¯å¯«ç”¨æ¨çš„ï¼š$dp[s|g[i][j]] = min(dp[s]+1)$ï¼Œæ¯”è¼ƒç›´è¦ºä¸€é»ã€‚

**ä½œæ³•2ï¼š** æ™‚é–“è¤‡é›œåº¦$O(n\cdot 2^n)$
ç•¶æˆ‘å€‘åœ¨åšç‹€æ…‹sçš„æ™‚å€™ï¼Œå¦‚æœæ˜¯ä¸Šé¢çš„æ–¹æ³•å°±æ˜¯$n^2$æƒéæ‰€æœ‰çš„é»çš„çµ„åˆï¼Œå…¶å¯¦æˆ‘å€‘å¯ä»¥åªè¦æ‰¾åˆ°så…¶ä¸­ä¸€ä½ç¬¬kä½æ˜¯1çš„ï¼Œå› ç‚ºé‚£ä¸€ä½æ‰€å°æ‡‰åˆ°çš„è±¬è±¬ä¸€å®šæœƒç¶“éï¼Œæ‰€ä»¥å°±å¯ä»¥é‡å°é‚£ä¸€ä½åšè½‰ç§»ï¼Œå¦‚æ­¤ä¸€ä¾†è·ŸkåŒåœ¨ä¸€å€‹æ‹‹ç‰©ç·šçš„æœ€å¤šåªæœƒæœ‰nå€‹ï¼Œè¤‡é›œåº¦å°±é™åˆ°äº†$O(n\cdot 2^n)$ã€‚é€™è£¡å¯ä»¥æ­é…ä¸€å€‹vector<int>line[N]è£æ¯ä¸€ä½æœ‰ç¶“éçš„å¯èƒ½çš„ç‹€æ…‹ã€‚

#### å®šç¾©

$dp[s]$ç‚ºç‹€æ…‹ç‚ºsçš„æ™‚å€™çš„æœ€å°æ‹‹ç‰©ç·šæ•¸é‡

#### è½‰ç§»å¼

$dp[s]=min(dp[s\&(\sim mask)]+1)$

é€™å€‹è½‰ç§»å¼æŒºæœ‰è¶£çš„ï¼Œæˆ‘å€‘çŸ¥é“å¦‚æœè¦å¾ç‹€æ…‹på¾—åˆ°ç‹€æ…‹sï¼Œå°æ–¼sæ˜¯0çš„bitï¼Œpä¹Ÿæ‡‰è©²æ˜¯0ï¼›å°æ–¼sæ˜¯1çš„bitï¼Œè‹¥maskæ˜¯1ï¼Œå‰‡pçš„bitè¦æ˜¯0ï¼Œåä¹‹å‰‡æ˜¯1ã€‚

```flow
st=>start: for each bit p in s
sub1=>subroutine: My Subroutine
cond=>condition: if p=1
e=>operation: set dp[i] to 0
io=>condition: if mask[i]=1
ss=>operation: set dp[i] to 1
sp1=>operation: set dp[i] to 0
sp2=>operation: set dp[i] to 1

st->cond->io
cond(yes)->io->e
cond(no)->e

io(yes)->sp1
io(no)->sp2
```

é€™å€‹è½‰ç§»å¼å¯ä»¥æœ‰å¦å¤–ä¸€å€‹è¡¨ç¤ºçš„æ–¹å¼ï¼Œå¯ä»¥é”åˆ°åŒæ¨£çš„æ•ˆæœï¼š
$dp[s]=min(dp[s\&(i\oplus mask)]+1)$

#### é‚Šç•Œ

$for\ each\ dp[i]=0$

ä»¥ä¸‹ç¨‹å¼ç¢¼æ˜¯ä»¥$O(n^3)$çš„é è™•ç†ï¼Œ$O(n\cdot 2^n)$çš„è½‰ç§»ï¼Œå› æ­¤ç¸½æ™‚é–“è¤‡é›œåº¦æ˜¯$O(2^n)$ï¼Œåœ¨æ™‚é™å…§æ˜¯å¯ä»¥éçš„ï¼
![](https://i.imgur.com/j8uRDfj.png)

> [time=Thu, Sep 16, 2021 3:03 PM]æ›´æ–°

çµæœå‘¢ï¼Œæœ‰äººå•äº†æˆ‘é€™ä¸€é¡Œï¼Œæˆ‘å›å»çœ‹æˆ‘çš„codeï¼Œçµæœç™¼ç¾æ˜æ˜æ‡‰è©²æ˜¯ $O(n\cdot 2^n)$ è½‰ç§»ï¼Œä½†æ¯ä¸€å€‹line_maskä¸­åœ¨worst caseå»æœ‰ $n^2$ å€‹ç‹€æ…‹ï¼Œé€™æ¨£å­ä¸‹ä¾†ä¸€æ¨£é‚„æ˜¯ $O(n^2\cdot 2^n)$ æ²’æœ‰é€²æ­¥ã€‚ç™¼ç¾å•é¡Œåœ¨æ–¼ï¼Œç•¶å…¨éƒ¨çš„é»éƒ½åœ¨åŒä¸€æ¢æ‹‹ç‰©ç·šä¸Šçš„æ™‚å€™ï¼Œæœƒæœ‰é‡è¤‡çš„ç‹€æ…‹è¢«pushå¾ˆå¤šæ¬¡çš„å•é¡Œï¼Œæ‰€ä»¥åªè¦ç”¨visitå»ç´€éŒ„é€™ç¨®ç‹€æ…‹æ˜¯å¦å‡ºç¾éï¼Œè®“æœ€å¤šè¢«æ¨å…¥ä¸€æ¬¡å°±å¥½!

![](https://i.imgur.com/V2ubK6i.png)

```cpp=
#include <bits/stdc++.h>
#define long long ll
#define N 24
#define mod 1000000007
#define FOR(i,n) for(int i=0;i<n;i++)
using namespace std;
int t,n,x[N],y[N];

void solve(){
    vector<int>line_mask[N];
    scanf("%d",&n);
    for(int i = 0;i < n;i++)scanf("%d %d",&x[i],&y[i]);
    int m = 1<<n,dp[m];
    bool visit[m];memset(visit,0,sizeof(visit));
    //calculate all lines O(n^3)
    for(int i=0;i<n;i++){
        line_mask[i].push_back(1<<i);       //æœ‰å¯èƒ½æ­¤é»å­¤ç«‹ä¸€äººï¼Œè¦ç¢ºä¿ä¹Ÿåœ¨è£¡é¢
        for(int j=i+1;j<n;j++){
            int x1 = x[i],y1 = y[i];
            int x2 = x[j],y2 = y[j];
            if(x1==x2)continue;

            double a = (double)((x1*y2)-(x2*y1))/(x1*x2*(x2-x1));
            double b = (double)(y1-a*x1*x1)/x1;
            if(a >= 0)continue;

            int mask1 = 1<<i|1<<j;
            for(int k = 0;k < n;k++){
                if(fabs((double)a*x[k]*x[k]+b*x[k]-y[k])<=1e-6)mask1|=(1<<k);
            }
            if(visit[mask1])continue;
            for(int k = 0;k < n;k++){
                if((mask1>>k) & 1)line_mask[k].push_back(mask1);
            }
            visit[mask1] = 1;
            //éké»çš„æ‰€æœ‰ç¶“éçš„é»çš„ç‹€æ…‹
        }
    }
    memset(dp,0x3f3f3f,sizeof(dp));
    dp[0] = 0;

    //O(n 2^nè½‰ç§»)
    for(int s = 1;s < m;s++){
        int cur = __lg(s),len = line_mask[cur].size();
        for(int i = 0;i < len;i++){
            int mk = line_mask[cur][i];
            dp[s] = min(dp[s], dp[(s&(~mk))] + 1);
            if(dp[s] == 1)break;
        }
    }
    printf("%d\n",dp[m-1]);
}

int main(){
    scanf("%d",&t);
    while(t--){
        solve();
    }
}
```

### ç¡¬å¹£å•é¡Œ

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/159/)

æœ‰é»è¨ç•°ï¼ŒåŸæœ¬æƒ³èªªæŠŠcodeä¸Ÿä¸Šå»æ¸¬ä¸€ä¸‹ï¼Œçœ‹çœ‹èƒ½éå‰é¢å¹¾ç­†æ¸¬è³‡ï¼Œçµæœå»ç›´æ¥å…¨éƒ¨éäº†ï¼æˆ‘ä¹Ÿæ²’æœ‰åšä»€éº¼ç‰¹åˆ¥çš„DPå„ªåŒ–ï¼Œä¸Ÿä¸Šå»å»ç›´æ¥Acceptäº†ï¼é€™é¡Œè·ŸåŸæœ¬çš„ç¡¬å¹£å•é¡Œæœ‰äº›è¨±çš„ä¸åŒï¼Œåœ¨æ–¼ä»–æœ‰é™åˆ¶æ¯ä¸€ç¨®ç¡¬å¹£çš„æ•¸é‡ï¼Œé¢é¡ç‚º $C_i$ çš„ç¡¬å¹£å…±æœ‰ $K_i$ å€‹ï¼Œä¹Ÿå°±æ˜¯è¦å•ä½ èƒ½å¦ç”¨é€™äº›å›ºå®šæ•¸é‡çš„ç¡¬å¹£æ¹Šå‡ºç‰¹å®šçš„é¢é¡ã€‚

æˆ‘å€‘å¯ä»¥è¨è«–ä¸åŒçš„é¢é¡çš„é¤˜æ•¸ï¼Œæ™‚é–“è¤‡é›œåº¦åˆ†æä¼°è¨ˆç´„ç‚ºï¼š$O(N\times C_i\times \frac{M}{C_i})=O(NM)$ï¼Œç…§ç†ä¾†èªªå› ç‚ºè¦åŸ·è¡Œtæ¬¡ï¼Œç®—ä¸‹ä¾†æœ‰å¯èƒ½æœƒTLEï¼Œä¸éé€™ä¸€é¡Œæ²’æœ‰å¡å°±æ˜¯äº†ã€‚

```cpp=
#include <bits/stdc++.h>
#define N 105
#define mod 1000000007
#define FOR(i,n) for(int i=0;i<n;i++)
#define ios ios::sync_with_stdio(0)
using namespace std;
int t;

void solve(){
    int n,m,val[N],num[N];cin>>n>>m;
    for(int i=0;i<n;i++)cin>>val[i]>>num[i];
    
    bool dp[20005];
    memset(dp,0,sizeof(dp));
    dp[0] = 1;
    
    for(int i=0;i<n;i++){
        for(int k=0;k<val[i];k++){
            int left = num[i];
            for(int j=k+val[i];j<=m;j+=val[i]){
                if(dp[j]!=0)left = num[i];
                else if(left>0 && dp[j-val[i]]){
                    left--;
                    dp[j] = 1;
                }
            }
        }
    }
    if(dp[m]==1)cout<<"Yes"<<endl;
    else cout<<"No"<<endl;
}

int main(){
    ios;
    cin>>t;
    while(t--){
        solve();
    }
}
```

### çƒé¾œç–Šç–Šæ¨‚---æ˜“

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/185/)
é€™é¡Œç°¡å–®ä¾†èªªï¼Œæ˜¯çµ¦å®šä¸€å€‹æ•¸åˆ—ï¼Œè¦å˜—è©¦åˆ†é…æˆå¥½å¹¾å †ï¼Œæ¯ä¸€å †çš„æ•¸é‡ä¸è¶…ékå€‹ã€‚å…¶ä¸­ç¬¬iå †çš„ç¸½å’Œä¹˜ä¸Š(i-1)ï¼Œç®—å‡ºä¾†çš„ç¸½å’Œè¦æœ€å°ã€‚ç”±é¡Œç›®æ•˜è¿°å¯ä»¥çŸ¥é“ï¼Œæ¯ä¸€å †åˆ°å¾Œé¢ä¹˜ä¸Šçš„æ•¸å­—æ˜¯è¶Šä¾†è¶Šå¤§ï¼Œä¹Ÿå°±æ˜¯è¢«åŠ ä¸Šçš„æ¬¡æ•¸æœƒè¶Šä¾†è¶Šå¤šï¼Œå¦‚æœæˆ‘å€‘å°‡æ•¸åˆ—å€’éä¾†dpæœƒæ¯”æ­£é¢åšä¾†å¾—å®¹æ˜“ç¶­è­·ã€‚

{% note success %}

**è½‰ç§»å¼**
dp[i] = max(dp[j]+pref[j]),for i-kâ‰¤jâ‰¤i-1ï¼Œprefæ˜¯ç¶­è­·å·²ç¶“ååºéå¾Œçš„æ•¸åˆ—ä¹‹å‰ç¶´å’Œã€‚ä»¥ç¯„æ¸¬ç‚ºä¾‹ï¼Œç•¶k=2æ™‚ï¼Œdp[i]å¯ä»¥é¸æ“‡çš„å°±æ˜¯å¾dp[i-1]è·Ÿdp[i-2]è½‰ç§»ï¼Œå¦‚æœé¸æ“‡dp[i-2]å°±è¡¨ç¤ºç¬¬ié …æœƒå’Œç¬¬i-1é …åˆä½µæˆä¸€å †ï¼ŒåŠ ä¸Špref[i-2]ä¹Ÿå°±æ˜¯æŠŠå‰é¢çš„æ¯ä¸€å †çš„æ•¸é‡ä¹˜ä¸Šçš„æ•¸å­—éƒ½åŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯åŠ ä¸Šä¸€å€‹å‰ç¶´å’Œï¼ˆç”±æ–¼æ¯ä¸€å€‹æ•¸å­—åªæœƒè¢«åˆä½µä¸€æ¬¡ï¼‰

**å°è­‰æ˜ï¼šæ¯ä¸€å€‹æ•¸å­—åªæœƒè¢«åˆä½µä¸€æ¬¡**
åœ¨è½‰ç§»çš„éç¨‹ä¸­ï¼Œæœ‰æ²’æœ‰å¯èƒ½æœƒç™¼ç”Ÿdp[i]è¦è½‰ç§»çš„å°è±¡æ˜¯dp[i-2]ï¼Œä½†dp[i-1]å»å·²ç¶“è¢«èåˆéäº†ï¼Œé€ æˆä¸‰å€‹çƒé¾œèåˆåœ¨ä¸€èµ·çš„æƒ…æ³ï¼Ÿ

ä¹Ÿå°±æ˜¯ä¸‹åœ–é€™ä¸€ç¨®æƒ…æ³ï¼Œdp[i-1]ã€dp[i-2]åˆä½µï¼Œdp[i]ã€dp[i-1]åˆä½µï¼Œè®Šæˆä¸‰å€‹èåˆè¶…ékçš„æƒ…æ³ï¼ˆdp[i-2],dp[i-1],dp[i]åˆä½µï¼‰ã€‚
![](https://i.imgur.com/3NufpZ9.png)
ç­”æ¡ˆï¼šä¸æœƒ

é¦–å…ˆå…ˆå¾dp[i-3]è½‰ç§»çš„dp[i-1]è¡¨ç¤ºç¬¬i-2è·Ÿi-1æ˜¯åˆä½µæˆä¸€å †ï¼Œæ¥ä¸‹ä¾†çš„dp[i]å¾dp[i-2]è½‰ç§»ï¼ŒåŠ ä¸Šäº†pref[i-2]ï¼Œä¹Ÿå°±æ˜¯æŠŠi-2ç¨ç«‹å‡ºå»ï¼Œiè·Ÿi-1åˆä½µæˆä¸€å †ï¼Œå› æ­¤ä¸æœƒæœ‰å¤§æ–¼kå€‹çƒé¾œåˆä½µåœ¨ä¸€èµ·çš„æƒ…æ³ã€‚
{% endnote %}

é€™ä¸€é¡Œçš„è½‰ç§»å¼ä¸å¥½æƒ³ï¼Œè¦æŠŠæ±è¥¿ååºä¹‹å¾Œæ¯”è¼ƒå¥½dpï¼Œè½‰ç§»å¼ä¹Ÿæ¯”è¼ƒå¥½å¯«å‡ºä¾†ï¼è§€å¯Ÿåˆ°è¶Šå¾Œé¢çš„æ•¸å­—è¢«é‡è¤‡åŠ çš„æ©Ÿæœƒæ¯”è¼ƒå¤§ï¼ˆé«˜åº¦è¶Šé«˜ï¼‰ï¼Œå› æ­¤å°‡æ•¸åˆ—çš„é †çºŒé¡›å€’æ­é…å‰ç¶´å’Œå°±èƒ½æ¯”è¼ƒæ–¹ä¾¿çš„è½‰ç§»ï¼

#### å®šç¾©

$dp[i]$å®šç¾©ç‚ºä½¿ç”¨1åˆ°iå€‹çƒé¾œï¼Œé•å’Œåº¦çš„æœ€å¤§å€¼

#### è½‰ç§»å¼

$dp[i] = max(dp[j]+pref[j]),for\ i-kâ‰¤jâ‰¤i-1$
é€™å€‹è½‰ç§»å¼æ˜¯å»ºç«‹åœ¨é †åºé¡›å€’çš„æƒ…æ³ï¼Œåœ¨è¼¸å…¥çš„æ™‚å€™é †ä¾¿æŠŠé€†åºã€‚

#### é‚Šç•Œ

$for\ each\ dp[i] = 0$

```cpp=
#include <bits/stdc++.h>
#define int long long
#define N 500005
#define ios ios::sync_with_stdio(0)
#define FOR(i,n) for(int i=0;i<n;i++)
using namespace std;
int n,k,arr[N],pref[N];

signed main(){
    ios;
    cin>>n>>k;
    for(int i=n;i>0;i--)cin>>arr[i];
    for(int i=1;i<=n;i++)pref[i] = pref[i-1]+arr[i];
    
    int dp[N];
    memset(dp,0,sizeof(dp));
    
    deque<pair<int,int>> deq;
    deq.push_back(make_pair(0,0));
    
    for(int i=1;i<=n;i++){
        while(!deq.empty() && deq.front().second<i-k)deq.pop_front();
        dp[i] = deq.front().first;
        while(!deq.empty() && deq.back().first <= dp[i]+pref[i])deq.pop_back();
        deq.push_back(make_pair(dp[i]+pref[i],i));
    }
    cout<<dp[n]<<endl;
}
```

## æ‰‹å¯«ä½œæ¥­

é€™ä¸€é€±çš„ä¸»é¡Œæ˜¯NPå•é¡Œä»¥åŠSATï¼Œè­‰æ˜å¥½é›£ã€æ•¸å­¸å¥½é›£ï¼

# è³‡èŠ½ç¬¬åé€±ï¼šé€²éšåœ–è«–ï¼ˆä¸€ï¼‰

## ä¸Šèª²å…§å®¹

### ä¸¦æŸ¥é›† Disjoint Set

ç›®æ¨™ï¼šå¿«é€Ÿåˆ¤æ–·å…©å€‹å…ƒç´ æ˜¯å¦åŒå±¬ä¸€å€‹é›†åˆ
åŠŸèƒ½ï¼šè©¢å•å…ƒç´ éš¸å±¬çš„é›†åˆã€åˆä½µå…©å€‹é›†åˆï¼Œåœ¨åœ–è«–ä¸­ï¼Œé›†åˆé€šå¸¸è¡¨ç¤ºé€£é€šå¿«ï¼Œä¸¦æŸ¥é›†å¯ä»¥æŸ¥è©¢ä»»å…©é»æ˜¯å¦é€£é€šã€‚åœ¨å¯¦ä½œMSTçš„æ™‚å€™ï¼Œç•¶æˆ‘å€‘è¦æª¢æŸ¥å…©å€‹é»é€£æ¥æˆçš„é‚Šæ˜¯å¦æœƒè·Ÿå…¶ä»–å·²ç¶“åŠ å…¥çš„é‚Šå½¢æˆç’°ï¼Œå°±æœƒä½¿ç”¨ä¸¦æŸ¥é›†å¹«åŠ©æˆ‘å€‘åˆ¤æ–·ï¼
è¤‡é›œåº¦ï¼šéå¸¸å„ªç§€ï¼Œå¯ä»¥èªªæ˜¯O(1)

```cpp=
#include <bits/stdc++.h>
#define N 100001
using namespace std;
int n,boss[N],num[N];

int find_boss(int a){        //ä½¿ç”¨è·¯å¾‘å£“ç¸®
    if(a==boss[a])return a;
    else return boss[a] = find_boss(boss[a]);
}

void merge(int a,int b){    //å•Ÿç™¼å¼åˆä½µ
    if(num[a]>=num[b]){     //è¼ƒå°çš„é›†åˆåˆä½µåˆ°è¼ƒå¤§çš„é›†åˆ
        num[a] += num[b];
        boss[b] = a;
    }
    else{
        num[b] += num[a];
        boss[a] = b;
    }
}
signed main(){
    cin>>n;
    for(int i=1;i<=n;i++){
        boss[i] = i;
        num[i] = 1;
    }
    while(1){
        int a,b;cin>>a>>b;                    //è¦æŸ¥è©¢å…©å€‹å…ƒç´ 
        a = find_boss(a),b = find_boss(b);    //åˆ¤æ–·æ˜¯å¦åŒå±¬ä¸€å€‹é›†åˆ
        if(a!=b){                             //è€å¤§ä¸åŒå±¬ä¸åŒé›†åˆ
            cout<<"ä¸åŒé›†åˆ"<<endl;
            merge(a, b);
        }
        else cout<<"åŒé›†åˆ"<<endl;
        for(int i=1;i<=n;i++)cout<<boss[i]<<" ";
        cout<<endl;
    }
}
```

{% note success %}
**è·¯å¾‘å£“ç¸®**
åœ¨å›å‚³éç¨‹ä¸­é †ä¾¿åˆ©ç”¨éè¿´æŠŠæ‰€ç¶“éçš„bossæŒ‡å‘æœ€ä¸Šé¢çš„bossï¼Œç”±å·¦åœ–è®Šæˆå³åœ–ï¼Œæ•ˆç‡æ›´é«˜ï¼ˆå¯¦æ¸¬å…¶å¯¦å·®ä¸å¤šï¼Œå¯èƒ½lognå·²ç¶“å¤ å°åŠ ä¸Šéè¿´æœ¬ä¾†å°±æ¯”è¼ƒæ…¢ï¼‰
ç”¨éè¿´å¯¦ç¾çš„ç‰¹æ€§å¯¦ç¾ï¼Œéè¿´æ‹‰ä¸Šä¾†çš„æ™‚å€™é †ä¾¿æ›´æ–°boss[x]ï¼š
![](https://i.imgur.com/k8FPb0U.png)

è·¯å¾‘å£“ç¸®æ­é…å•Ÿç™¼å¼åˆä½µï¼Œè¤‡é›œåº¦ï¼š$O(Î±(N))$ç­‰åŒå¸¸æ•¸
{% endnote %}

## ä¸Šæ©Ÿä½œæ¥­

### æœ€å°ç”Ÿæˆæ¨¹

[é¡Œç›®é€£çµNEOJ](https://neoj.sprout.tw/problem/734/)
[é¡Œç›®é€£çµTIOJ](https://tioj.ck.tp.edu.tw/problems/1211)
[å¯¦ä½œè¬›ç¾©](https://reurl.cc/ze8Qr6)
[è³‡èŠ½è¬›ç¾©](https://www.csie.ntu.edu.tw/~sprout/algo2021/ppt_pdf/week11/Minimum_spanning_tree.pdf)

é€™ä¸€é¡Œæ‰‹åˆ»æœ€å°ç”Ÿæˆæ¨¹ï¼Œæ„Ÿè¦ºè »å¥½çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨ä¸€äº›æ€§è³ªä¾†å¯¦ä½œæœ€å°ç”Ÿæˆæ¨¹

#### æ€§è³ªä¸€ï¼šæ¨¹

æœ€å°ç”Ÿæˆåœ–ä¸€å®šæœƒæ˜¯ä¸€æ£µæ¨¹ï¼Œä¸å…·å‚™ç’°ï¼Œä¸”ä¸€å…±æœ‰n-1æ¢é‚Š
å¦‚æœé€™å¼µåœ–ä¸æ˜¯æ¨¹ï¼Œå‰‡å¿…å®šæœ‰ç’°ï¼Œå³ä»£è¡¨å¯ä»¥å†æ‹”æ‰ä¸€æ¢é‚Šä½¿æ¬Šé‡å’Œæ›´å°

#### æ€§è³ªäºŒï¼šCycle Property

Cæ˜¯åœ–ä¸Šçš„ä¸€å€‹ç’°ï¼Œeæ˜¯Cä¸Šæ¬Šé‡æœ€å¤§ä¸€æ¢é‚Šï¼Œå‰‡eå¿…ä¸åœ¨MSTä¸€éƒ¨åˆ†ï¼ˆè­‰æ˜ï¼šåè­‰ï¼Œå‡è¨­eåœ¨MSTï¼Œå‰‡åŠ å…¥å¦ä¸€é‚Šæ¯”eæ¬Šé‡æ›´å°å½¢æˆç’°ï¼Œæ­¤æ™‚æŠŠeæ‹”æ‰å¯ä»¥å½¢æˆæ›´å°çš„æ¬Šé‡å’Œï¼Œå› æ­¤çŸ›ç›¾ï¼‰

#### æ€§è³ªä¸‰ï¼šCut Property

æŠŠåœ–ä¸Šçš„é»é›†åˆ†å‰²æˆå…©åŠï¼Œå‰‡cutä¸Šé¢çš„é‚Šé›†åˆä¸­æœ€å°æ¬Šé‡çš„é‚Šeæœƒåœ¨MSTè£¡é¢ï¼ˆè­‰æ˜ï¼šåè­‰ï¼Œå‡è¨­eä¸åœ¨MSTï¼Œå‰‡åŠ å…¥eæœƒå½¢æˆé€£æ¥å…©åŠç¯€é»çš„ç’°ï¼Œæ­¤æ™‚æ‹”æ‰å¦ä¸€æ¯”eæ¬Šé‡å¤§çš„é‚Šï¼Œæœƒå½¢æˆæ›´å°æ¬Šé‡å’Œï¼Œå› æ­¤çŸ›ç›¾ï¼‰

åˆ©ç”¨æ€§è³ªäºŒã€æ€§è³ªä¸‰ï¼Œå°±å¯ä»¥åˆ©ç”¨Kruskalæ¼”ç®—æ³•ï¼šåˆ©ç”¨åˆ°ä½µæŸ¥é›†çš„ç¶­è­·æ­é…è·¯å¾‘å£“ç¸®ï¼Œå¯ä»¥å¿«é€Ÿåˆ¤æ–·ä¸€å€‹å…ƒç´ æ˜¯å¦èˆ‡å¦ä¸€å€‹å…ƒç´ åŒå±¬ä¸€å€‹é›†åˆï¼ˆè¤‡é›œåº¦å¹¾ä¹å¯ä»¥$O(1)$ï¼Œæ›´æº–ç¢ºä¾†èªªæ˜¯[$O(\alpha)$](https://zh.wikipedia.org/wiki/%E9%98%BF%E5%85%8B%E6%9B%BC%E5%87%BD%E6%95%B8)ï¼‰ï¼ŒKruskalç¸½è¤‡é›œåº¦ç‚º $O(ElogE)$
å¦å¤–é‚„æœ‰ä¸€ç¨®å¯¦ä½œæ–¹å¼**Prim's algorithm**ï¼Œç­‰ç­‰å†çœ‹

{% note info %}
**å¯¦ä½œæ­¥é©Ÿ**

**1. åˆå§‹åŒ–è¨­å®šï¼š** è¨­å®šå¥½bossä»¥åŠé›†åˆå¤§å°ç­‰åƒæ•¸

**2. å°æ‰€æœ‰çš„é‚Šä¾ç…§æ¬Šé‡æ’åºï¼š** åˆ©ç”¨$O(m\log m)$çš„æ™‚é–“æ’åºï¼Œå°‡é‚Šä¾ç…§æ¬Šé‡ç”±å°åˆ°å¤§åŠ å…¥MSTä¸­

**3. ä¾åºåŠ å…¥é‚Šï¼š** ä»¥ä¸‹æœƒæœ‰å…©ç¨®æƒ…æ³ï¼Œå¯ä»¥ç”¨ä¸¦æŸ¥é›†+è·¯å¾‘å£“ç¸®ï¼ˆå„ªåŒ–ï¼‰åˆ¤æ–·æ˜¯å¦æœƒå½¢æˆç’°

- Case 1: å¦‚æœåŠ äº†é€™æ¢é‚Šå½¢æˆç’°ï¼ˆæŸ¥åˆ°æœ‰ä¸€æ¨£çš„bossï¼‰
  - é‚£é€™æ¢é‚Šæœƒæ˜¯é€™å€‹ç’°ä¸Šçš„æœ€å¤§é‚Š
  - æ ¹æ“š Cycle propertyï¼Œ<font color="#f00">é€™æ¢é‚Šä¸æœƒæ˜¯MSTçš„ä¸€éƒ¨åˆ†</font>
- Case 2: åŠ äº†é€™æ¢é‚Šä¸æœƒå½¢æˆç’°
  - é‚£é€™æ¢é‚Šæ˜¯æ¢æ©‹ï¼Œé€£æ¥å·¦å³å…©æ£µæ¨¹
  - æ ¹æ“š Cut Propertyï¼Œå› ç‚ºé€™æ¢é‚Šæ˜¯é€™å€‹ cut ä¸Šæœ€å°çš„é‚Š
  - æ‰€ä»¥<font color="#f00">é€™æ¢é‚Šæœƒæ˜¯ MST çš„ä¸€éƒ¨åˆ†</font>

**4. åˆ¤æ–·æ˜¯å¦åˆæ³•ï¼š** nå€‹é»æ‰€å½¢æˆçš„æ¨¹æœƒæœ‰n-1æ¢é‚Šï¼Œæœ€å°ç”Ÿæˆæ¨¹æ˜¯ä¸€æ£µæ¨¹å°±å¿…é ˆæ»¿è¶³æ¢ä»¶ã€‚
{% endnote %}

#### KRUSKAL'S ALGORITHM

![](https://i.imgur.com/sDAXXKI.png)

```cpp=
#include <bits/stdc++.h>
#define int long long
#define N 200005
#define ios ios::sync_with_stdio(0),cin.tie(0)
using namespace std;
int n,m,num[N],boss[N];
struct Node{
    int x,y,w;
}edge[N];

bool cmp(Node a, Node b){
    return a.w < b.w;
}
int findboss(int a){                    //å°‹æ‰¾é›†åˆçš„è€å¤§ï¼ˆä»£è¡¨æ•´å€‹é›†åˆï¼‰
    if(a==boss[a])return a;
    return boss[a]=findboss(boss[a]);   //éè¿´æ­é…è·¯å¾‘å£“ç¸®
}

signed main(){
    ios;
    cin>>n>>m;
    for(int i=0;i<m;i++){
        cin>>edge[i].x>>edge[i].y>>edge[i].w;
    }
    for(int i=0;i<n;i++){
        num[i] = 1;
        boss[i] = i;
    }
    sort(edge,edge+m,cmp);                 //ä¾ç…§æ¬Šé‡å¤§å°æ”¾å…¥MST
    int result = 0,num_edge = 0;
    for(int i=0;i<m && num_edge<n;i++){    //æ¨¹å¿…é ˆæ»¿è¶³å°æ–¼n-1æ¢é‚Š
        int a = findboss(edge[i].x),b = findboss(edge[i].y);
        if(a!=b){                          //bossä¸åŒå¯ä»¥æ”¾å…¥MSTï¼ˆåŠ å…¥ä¸æœƒå½¢æˆç’°by Cut Propertyï¼‰
            if(num[a]>=num[b]){            //åŸ·è¡Œå•Ÿç™¼å¼åˆä½µ
                boss[b] = a;
                num[a]+=num[b];
            }
            else{
                boss[a] = b;
                num[b]+=num[a];
            }
            result+=edge[i].w;
            num_edge++;
        }
    }
    cout<<result<<endl;
    //é€™é‚Šå¯ä»¥åˆ¤æ–·num_edge==n-1æœ‰æ²’æœ‰æˆç«‹ï¼Œä¸éé¡Œç›®æ˜¯è¼¸å…¥éƒ½å¯ä»¥å½¢æˆMST
}
```

### Prim's Algorithm

æ˜¯ä¸€ç¨®è²ªå©ªæ¼”ç®—æ³•ï¼Œé¦–å…ˆå–ä»»ä¸€é»åŠ å…¥æœ€å°ç”Ÿæˆæ¨¹ä¸­ï¼Œæ¥è‘—å°‡é€£åˆ°çš„é‚ŠåŠ å…¥heapä¸­ï¼Œæ¯ä¸€æ¬¡å–å‡ºheapä¸­é‚Šæ¬Šé‡æœ€å°çš„é‚Šï¼Œå¦‚æœé€™ä¸€æ¢é‚Šé€£åˆ°çš„é»å°šæœªè¢«èµ°è¨ªï¼Œå‰‡åŠ å…¥é€™ä¸€æ¢é‚Šç‚ºæœ€å°ç”Ÿæˆæ•¸ã€‚æ­£ç¢ºæ€§è­‰æ˜å‰‡å¯ç”¨cut proprityè­‰æ˜æ¯æ¬¡éƒ½åŠ å…¥æ¬Šé‡æœ€å°çš„é‚Šå³ç‚ºæœ€å°ç”Ÿæˆæ•¸ã€‚

![](https://i.imgur.com/ZFELWZq.png)

```cpp=
#include <bits/stdc++.h>
#define Orz ios::sync_with_stdio(0),cin.tie(0)
#define rep(i,a,b) for(int i=a;i<=b;i++)
#define pii pair<int,int>
#define pdd pair<double,double>
#define int long long
#define ll long long
#define ld long double
#define N 200005
#define eps 1e-9
#define x first
#define y second
using namespace std;
int n,m;
bool visit[N];

struct node{
    int to,w;
};
vector<node> edge[N];

struct cmp{
    bool operator()(node a,node b){
        return a.w > b.w;
    }
};

signed main(){
    Orz;
    memset(visit,0,sizeof(visit));
    cin>>n>>m;
    rep(i,0,m-1){
        int a,b,w;cin>>a>>b>>w;
        edge[a].push_back({b,w});
        edge[b].push_back({a,w});
    }
    priority_queue<node,vector<node>,cmp> pq;
    visit[1] = 1;
    for(auto i : edge[1])pq.push(i);
    int num_edge = 0,ans = 0;
    while(num_edge < n-1){
        node x = pq.top();pq.pop();
        if(visit[x.to])continue;
        visit[x.to] = 1;
        num_edge += 1;
        ans += x.w;
        for(auto i : edge[x.to]){
            pq.push(i);
        }
    }
    cout<<ans<<endl;
}
```

### é«˜æ£•æ«šçš„æ„å¤–æ”¶ç©«

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/169/)
[è¬›ç¾©é€£çµ](https://www.csie.ntu.edu.tw/~sprout/algo2021/ppt_pdf/week11/euler_hamilton.pdf)

é€™ä¸€é¡Œå°±æ˜¯æŒ‰ç…§å­—å…¸åºprintå‡ºå°¤æ‹‰è·¯å¾‘ï¼Œç‰¹åˆ¥ç”¨**é„°æ¥çŸ©é™£**ä¾†å­˜åœ–æ˜¯å› ç‚ºè¦æŒ‰ç…§å­—å…¸åºè¼¸å‡ºï¼Œå¦‚æœç”¨éˆçµä¸²åˆ—ä¾†å­˜é‚„è¦èŠ±æ™‚é–“æ’åºï¼Œå› æ­¤ç”¨å¤§ä¸€é»çš„ç©ºé–“ä¾†ç¯€çœæ™‚é–“

å°¤æ‹‰è·¯å¾‘ä¹Ÿæ˜¯ä¸€ç­†ç•«å•é¡Œï¼Œæ¯ä¸€å€‹ç¯€é»ä¸€å®šæœƒæœ‰é€²æœ‰å‡ºï¼Œå› æ­¤åŸå…ˆçš„ç„¡å‘åœ–ä¸Šæ¯ä¸€é»ä¸€å®šåº¦æ•¸ç‚ºå¶æ•¸ï¼Œè‹¥æœ‰å¥‡é»å‰‡é¸æ“‡å…¶ä¸­ä¸€å€‹å¥‡é»ä½œç‚ºèµ·é»ï¼Œç•¶å¥‡é»æ•¸é‡è¶…éå…©å€‹å‰‡ä»£è¡¨ç„¡è§£ã€‚æˆ‘å€‘å°‡DFSçš„éç¨‹ä¸­é›¢é–‹ç•¶å‰ç¯€é»çš„é †åºç´€éŒ„èµ·ä¾†ï¼Œé€†åºè¼¸å‡ºå°±æ˜¯ä¸€çµ„åˆæ³•æ­æ‹‰è¿´è·¯çš„è§£äº†ï¼
{% note info %}
**å¯¦ä½œç¨‹åº**

**1. åˆ¤æ–·å¥‡é»å€‹æ•¸**ï¼Œè‹¥å¥‡é»å€‹æ•¸kï¼š

- k > 2ï¼Œé‚£éº¼ç„¡è§£
- k = 2ï¼Œå‰‡é¸æ“‡å…¶ä¸­ä¸€å€‹å¥‡é»ä½œç‚ºèµ·é»
- k = 0ï¼Œå‰‡é¸æ“‡ä»»æ„ä¸€å€‹é»ä½œç‚ºèµ·é»

**2. DFS åŸ·è¡Œä¸‹åˆ—æ­¥é©Ÿ**
> è‹¥ç•¶å‰ç¯€é»é‚„æœ‰å°šæœªèµ°éçš„é‚Šï¼Œé‚£éº¼æ‹œè¨ªè©²é‚Šï¼Œä¸¦åœ¨æ‹œè¨ªå®Œå¾Œè¼¸å‡ºè©²é‚Š
> å¦å‰‡é›¢é–‹ç•¶å‰çµé»

**3. è‹¥é‚„æœ‰ç¯€é»å°šæœªæ‹œè¨ªï¼Œå‰‡ç„¡è§£**
**4. å¦å‰‡è¼¸å‡ºé †åºå³ç‚ºä¸€çµ„è§£**
{% endnote %}

```cpp=
#include <bits/stdc++.h>
#define N 501
using namespace std;
int n,Edge[N][N],ans[1025],ind = 0;

void DFS(int cur){
    for(int i=1;i<=500;i++){
        if(Edge[cur][i]){
            Edge[cur][i]--;Edge[i][cur]--;
            DFS(i);
        }
    }
    ans[ind++] = cur;
}

signed main(){
    cin>>n;
    memset(Edge, 0, sizeof(Edge));
    for(int i=0;i<n;i++){
        int a,b;cin>>a>>b;
        Edge[a][b]++;
        Edge[b][a]++;
    }
    int start = 1;                //é–‹å§‹çš„ç¯€é»ç·¨è™Ÿ
    for(int i=1;i<=500;i++){
        int sum = 0;
        for(int j=1;j<=500;j++){
            sum+=Edge[i][j];
        }
        if(sum%2!=0){             //æ‰¾åˆ°ç¬¬ä¸€å€‹åº¦æ•¸ç‚ºå¥‡æ•¸çš„ç¯€é»
            start = i;
            break;
        }
    }
    DFS(start);
    for(int i=ind-1;i>=0;i--)cout<<ans[i]<<endl;
}
```

### é™£ç·šæ¨é€²

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/165/)
æ‹“å¢£æ’åºé¡Œï¼Œå…©ç¨®å¯¦ä½œæ–¹å¼ï¼Œç¬¬ä¸€æ˜¯BFSè®Šå½¢å¯¦ä½œï¼ˆqueueå¯¦ä½œï¼‰ï¼Œè¢«popå‡ºä¾†çš„é †åºå°±æ˜¯topological sort
ç¬¬äºŒç¨®å°±æ˜¯DFSæ­é…æ™‚é–“æˆ³è¨˜ï¼Œæœ€æ™šé›¢é–‹çš„æ”¾åœ¨æœ€å‰é¢

é€™ä¸€é¡Œæ˜¯æŠŠå…¥åº¦ç‚º0çš„ç¯€é»å…ˆpushé€²priority_queueï¼ˆæŒ‰ç…§å­—å…¸åºï¼‰ï¼Œç•¶ä¸€å€‹é»è™•ç†éä¹‹å¾Œï¼Œå…¥åº¦è®Šæˆ0çš„æ‰€æœ‰å®ƒæŒ‡å‘çš„é»åœ¨pushé€²queueè£¡é¢
æ‹“å¢£æ’åºå¯ä»¥ç”¨åœ¨DAGçš„åˆ¤å®šä»¥åŠè§£æ±ºå…·æœ‰ä¾è³´é—œä¿‚çš„å•é¡Œ

```cpp=
#include <bits/stdc++.h>
#define N 100001
using namespace std;
int t,n,m,deg[N];//å…¥åº¦
int ans[N],ind = 0;

signed main(){
    cin>>t;
    while(t--){
        memset(deg,0,sizeof(deg));
        memset(ans, 0, sizeof(ans));
        ind = 0;
        vector<int> edge[N];
        cin>>n>>m;
        for(int i=0;i<m;i++){
            int a,b;cin>>a>>b;
            edge[a].push_back(b);
            deg[b]++;
        }
        priority_queue<int,vector<int>,greater<int> > qq;//priority_queueå–ä»£queue
        for(int i=0;i<n;i++)if(deg[i]==0)qq.push(i);
        while(!qq.empty()){
            int cur = qq.top();
            qq.pop();
            ans[ind++] = cur;
            int len = edge[cur].size();
            for(int i=0;i<len;i++){
                deg[edge[cur][i]]--;
                if(deg[edge[cur][i]]==0)
                    qq.push(edge[cur][i]);
            }
        }
        if(ind==n){
            cout<<ans[0];
            for(int i=1;i<n;i++)cout<<" "<<ans[i];
            cout<<endl;
        }
        else cout<<"QAQ"<<endl;
    }
}
```

## æ‰‹å¯«ä½œæ¥­

é€™ä¸€æ¬¡çš„æ‰‹å¯«ä¹Ÿè »å›°é›£çš„ï¼Œè¨è«–BIT(fenwick tree)çš„å¯¦ä½œä»¥åŠè¤‡é›œåº¦ï¼

# è³‡èŠ½ç¬¬åä¸€é€±ï¼šé€²éšåœ–è«–ï¼ˆäºŒï¼‰

## ä¸Šèª²å…§å®¹

### é›™é€£é€šå…ƒä»¶

æ¨¹å£“å¹³ã€é»é›™é€£é€šã€é‚Šé›™é€£é€š

### SCCå¼·é€£é€šå…ƒä»¶

LCAï¼ˆæœ€ä½å…±åŒç¥–å…ˆï¼‰

## ä¸Šæ©Ÿä½œæ¥­

### é«˜æ£•æ«šå‚³ééˆ

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/183/)
åœ¨ä¸€å¼µåœ–ä¸­æ‰¾å‰²é»ï¼ˆå®šç¾©ï¼šæ‹”æ‰å®ƒæ•´å¼µåœ–å°±ä¸é€£é€šäº†ï¼‰
ä½œæ³•ï¼šå¦‚æœç”¨æš´åŠ›ï¼Œå¯ä»¥æ¯ä¸€å€‹é»æ‹”æ‰ï¼Œåšä¸€æ¬¡DFSåˆ¤æ–·æ˜¯å¦è¯é€šï¼ˆæ•ˆç‡å¤ªå·®ï¼‰

æ•ˆç‡æ›´é«˜çš„å°±æ˜¯**Trajan æ¼”ç®—æ³•**æ‰¾AP(articulation point)

{% note info %}
**Tarjan's algorithm æ‰¾ AP**
é‚Šçš„ç¨®é¡å¯ä»¥åˆ†æˆï¼šTree edge,Back edge,Forward edge,Cross edgeï¼Œå…¶ä¸­ç„¡å‘åœ–ä¸­åªæœƒæœ‰æ¨¹é‚Šè·Ÿå›é‚Šï¼ˆæŒ‰ç…§ç„¡å‘é‚ŠDFSçš„çµæœï¼ŒFoward edge éƒ½æœƒè®Šæˆå­å­«çš„back edge, cross edge æœƒè®Šæˆæ¨¹é‚Šï¼‰

ç¶­è­·ä¸€å€‹lowå‡½æ•¸ï¼Œä»£è¡¨ä¸ç¶“éçˆ¶ç¯€é»èƒ½åˆ°çš„æœ€å°æ™‚é–“æˆ³è¨˜ï¼ˆé€²å…¥ï¼‰çš„ç¯€é»ï¼Œlvå‡½æ•¸ç‚ºç•¶å‰ç¯€é»çš„æ™‚é–“æˆ³è¨˜ã€‚ä¸€å€‹é»æ˜¯ä¸æ˜¯å‰²é»ï¼Œåªè¦ä»–çš„ä»»æ„å­ç¯€é»çš„lowå‡½æ•¸å¤§æ–¼ç­‰æ–¼è‡ªå·±çš„æ™‚é–“æˆ³è¨˜ç·¨è™Ÿï¼Œé‚£æŠŠé€™å€‹é»æ‹”æ‰ï¼Œä»–å°å­©å°±èµ°ä¸åˆ°ç¥–å…ˆäº†ï¼ˆå¦‚æœèµ°å¾—åˆ°ç¥–å…ˆï¼Œå°æ–¼é€™ä¸€æ£µå­æ¨¹ï¼Œæ‹”æ‰ç•¶å‰ç¯€é»å°±å¯åˆ©ç”¨æ­¤é‚Šç¹¼çºŒé€£é€šï¼‰ï¼Œæ‰€ä»¥ä»–å°±æ˜¯å‰²é»ã€‚
æ›´æ–°ï¼š$low[now] = min(low[now],low[next])$åˆ†åˆ¥ç‚ºåˆ©ç”¨å­å­«æˆ–é è‡ªå·±
{% endnote %}

å¿…é ˆè¦æ³¨æ„çš„æ˜¯ï¼Œå‰²é»åˆ¤æ–·æ™‚è¦æŠŠrootçš„ç‰¹ä¾‹ç¨ç«‹åˆ¤æ–·ã€‚å…¶å¯¦rootåè€Œæ¯”è¼ƒç°¡å–®ï¼Œå¦‚æœrootæœ‰è¶…éä¸€å€‹å­æ¨¹ï¼Œä»£è¡¨æ‹”æ‰rootä»¥å¾Œæœƒåˆ†è£‚æˆä»¥æ¯å€‹å­æ¨¹ç‚ºå–®ä½çš„é€£é€šå¡Š

```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0);
#define int long long
#define N 1000001
using namespace std;
int n,m,low[N],lv[N],es=1,root,son_cnt = 0;
bool visit[N],ans[N];
vector<int> edge[N];
//lowå‡½æ•¸ç‚ºä¸ç¶“éçˆ¶ç¯€é»èƒ½åˆ°çš„æœ€å°æ™‚é–“æˆ³è¨˜,lvç‚ºç•¶å‰é€²å…¥æ™‚é–“æˆ³è¨˜

void DFS(int now,int father){
    visit[now] = 1;             //å°‡æ­¤é»è¨­ç‚ºå·²æ‹œè¨ª
    low[now] = lv[now] = es++;  //é€²å…¥çš„æ™‚é–“æˆ³è¨˜
    
    int len = edge[now].size();
    for(int i=0;i<len;i++){     //æ‹œè¨ªæ¯ä¸€å€‹å­å­«
        int next = edge[now][i];
        if(now==root && !visit[next])son_cnt++;//è¨ˆç®—rootå°å­©ï¼ˆè™•ç†ç‰¹ä¾‹ï¼‰
        if(!visit[next]){       //æ’é™¤èµ°åˆ°ç¥–å…ˆçš„æƒ…æ³
            DFS(next, now);
            if(low[next]>=lv[now] && now!=root)ans[now]=1;
            //ç„¡æ³•é€éå°å­©åˆ°é”æ¯”è‡ªå·±æ·ºçš„ç¯€é»ï¼Œå°‡nowè¨­ç‚ºAP
        }
        if(next!=father)low[now] = min(low[now],low[next]);
        //æ’é™¤æŒ‡å‘çˆ¶è¦ªçš„æƒ…æ³ï¼Œå¦‚æœç¶“éçˆ¶è¦ªï¼Œæ‹”æ‰å°±ä¸èƒ½å¾€æ›´ä¸Šé¢å»
    }
}

signed main(){
    ios;
    cin>>n>>m;
    memset(lv, 0, sizeof(lv));
    memset(low, 0, sizeof(low));
    memset(visit, 0, sizeof(visit));
    memset(ans,0,sizeof(ans));
    
    for(int i=0;i<m;i++){
        int x,y;cin>>x>>y;
        edge[x].push_back(y);
        edge[y].push_back(x);
    }
    for(int i=0;i<n;i++){
        if(!visit[i]){
            root = i;
            son_cnt = 0;
            DFS(i, i);
            if(son_cnt>1)ans[root] = 1;
        }
    }
    for(int i=0;i<n;i++)if(ans[i])cout<<i<<endl;
}
```

### è¬ è¨€å•é¡Œ

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/179)
è·Ÿä¸Šä¸€é¡Œï¼ˆé«˜æ£•æ«šå‚³ééˆï¼‰è »é¡ä¼¼çš„ï¼Œä¸€æ¨£æ‰¾åˆ°å‰²é»ï¼Œä¸åŒçš„æ˜¯è¦åœ¨DFSéç¨‹ä¸­åŒæ™‚ç´€éŒ„å­æ¨¹ç¯€é»çš„æ•¸é‡ã€‚å¦‚æœç¢°åˆ°å‰²é»ï¼Œç¶­è­·æ‹”æ‰å®ƒä¹‹å¾Œåˆ†è£‚å‡ºå»é‚£äº›å­æ¨¹çš„ç¯€é»å€‹æ•¸ï¼Œåˆ°æ™‚å€™é€éç¯€é»ç¸½æ•¸-æ‹”æ‰å¾Œåˆ†è£‚å€‹æ•¸å³å¯æ¨ç®—æœ‰å¹¾å€‹äººæœƒçŸ¥é“è¬ è¨€ï¼Œå–minå³å¯

```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0);
#define int long long
#define N 30001
using namespace std;
int n,m,root,lv[N],low[N],tree_cnt[N],es = 1;
bool visit[N],ans[N];
vector<int> edge[N];

int DFS(int now,int father){      //å›å‚³ç•¶å‰å­ç¯€é»å€‹æ•¸
    visit[now] = 1;
    lv[now] = es;
    low[now] = es++;
    
    int len = edge[now].size(),sum=1;//è¨ˆç®—ç¯€é»æ•¸
    for(int i=0;i<len;i++){
        int next = edge[now][i];     //ä¸‹ä¸€å€‹ç¯€é»
        
        if(!visit[next]){
            int temp = DFS(next,now);
            sum += temp;
            if(low[next] >= lv[now] && now!=root){ //ä¸èƒ½æ‹”æ‰root
                ans[now] = 1;           //è¨­ç‚ºAP
                tree_cnt[now] += temp;  //è¢«æ‹”æ‰å¾Œå¯è¢«åˆ†å‰²æˆå¹¾å€‹é€£é€šå¡Šç¯€é»æ•¸
            }
        }
        if(next!=father)low[now] = min(low[now],low[next]);
    }
    return sum;
}

signed main(){
    ios;
    cin>>n>>m;
    for(int i=0;i<m;i++){
        int x,y;cin>>x>>y;
        edge[x].push_back(y);
        edge[y].push_back(x);
    }
    cin>>root;
    
    memset(ans, 0, sizeof(ans));
    memset(visit, 0, sizeof(visit));
    memset(tree_cnt, 0, sizeof(tree_cnt));
    
    int sum = DFS(root,root),min_cnt = INT_MAX,min_pos = 0;
    
    for(int i=1;i<=n;i++){
        int temp = sum-tree_cnt[i]; //æ‹”æ‰å¾Œå‰©ä¸‹é€£é€šå¡Šå¤§å°ï¼ˆè·Ÿrooté€£çš„ï¼‰
        if(ans[i] && temp < min_cnt){
            min_pos = i;        //æ‹”æ‰ç¬¬å¹¾å€‹
            min_cnt = temp;     //æ›´æ–°æ‹”æ‰å¾Œå‰©ä¸‹é€£é€šå¡Šå¤§å°
        }
    }
    if(min_cnt == INT_MAX)cout<<0<<endl;
    else cout<<min_pos<<" "<<min_cnt<<endl;
}

```

### é«˜æ£•æ«šå‚³ééˆ

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/183/)
å‰å…©é¡Œæ‰¾å‰²é»ï¼Œé€™ä¸€é¡Œæ˜¯æ‰¾æ©‹ï¼Œè·Ÿæ‰¾å‰²é»çš„æ–¹æ³•å¹¾ä¹ä¸€æ¨£ï¼Œè€Œä¸”å°æ–¼é‚Šé‚„ä¸éœ€è¦è¨è«–rootçš„æƒ…æ³ï¼ˆrootè®Šæˆä¸æ˜¯ç‰¹ä¾‹ï¼‰ï¼Œç„¶å¾Œåˆ¤æ–·å‰²é»çš„ >= è®Šæˆ >ï¼ŒåŸå› å¯ä»¥é€éç•«åœ–ç†è§£ï¼ˆæŠŠé»æ‹”æ‰è·ŸæŠŠé‚Šæ‹”æ‰çš„å·®åˆ¥ï¼‰ï¼Œå°±å¯ä»¥å¯¦ä½œäº†ï¼
é¡Œç›®æœ‰ä¸€å€‹ç‰¹åˆ¥çš„è¦æ±‚ï¼ŒæŒ‰ç…§çµ¦é‚Šçš„é †åºé€²è¡Œè¼¸å‡ºï¼Œé‚£å¯ä»¥æ­é…setä¾†å¿«é€ŸæŸ¥çœ‹æŸä¸€å…ƒç´ æ˜¯å¦åœ¨é›†åˆå…§$O(logN)$ï¼Œæ¥è‘—å°±æŒ‰ç…§çµ¦å®šçš„æ¢ä»¶ä¾†è¼¸å‡º

```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0);
#define int long long
#define N 1000001
using namespace std;
int n,m,lv[N],low[N],timestamp = 1;
bool visit[N];
vector<int> edge[N];
vector<pair<int, int>> ans;
set<pair<int, int>>s;

void DFS(int now,int father){
    lv[now] = low[now] = timestamp++;
    visit[now] = 1;
    
    int len = edge[now].size();
    for(int i=0;i<len;i++){
        int next = edge[now][i];
        
        if(!visit[next]){
            DFS(next, now);
            if(low[next] > lv[now]){
                if(next<now)s.insert(make_pair(next,now));
                else s.insert(make_pair(now, next));
            }
        }
        if(next!=father)low[now] = min(low[now],low[next]);
    }
}

signed main(){
    ios;
    cin>>n>>m;
    for(int i=0;i<m;i++){
        int x,y;cin>>x>>y;
        edge[x].push_back(y);
        edge[y].push_back(x);
        ans.push_back(make_pair(x, y));
    }
    memset(visit, 0, sizeof(visit));
    
    for(int i=1;i<=n;i++){
        if(!visit[i]){
            DFS(i, i);
        }
    }
    for(int i=0;i<m;i++){
        pair<int, int> temp = ans[i];
        if(s.find(temp)!=s.end()){
            cout<<temp.first<<" "<<temp.second<<endl;
        }
    }
}
```

### èŠ½èŠ½é€›å¤§è¡—

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/739/)
æœ‰å‘ç„¡ç’°åœ–çš„ case â†’ DAG æœ€é•·è·¯å¾‘!
å°‡æ¯å€‹å¼·é€£é€šå…ƒä»¶ç¸®æˆé»å¾Œï¼Œå› ç‚ºå…§éƒ¨çš„é»å¯ä»¥ä¸€ç›´äº‚èµ°å…¨éƒ¨èµ°åˆ°ï¼Œæ‰€ä»¥åªè¦å°‡æ–°é»çš„é»æ¬Šæ›´æ–°æˆå…§éƒ¨æ‰€æœ‰é»çš„é»æ¬Šç¸½å’Œï¼Œå¾—åˆ°ä¸€å¼µæ–°çš„æœ‰å‘ç„¡ç’°åœ–ï¼Œå°±å¯ä»¥ç›´æ¥åš DAG æœ€é•·è·¯å¾‘å¾—åˆ°ç­”æ¡ˆã€‚

```cpp=
#include <bits/stdc++.h>
#define int long long
#define ios ios::sync_with_stdio(0),cin.tie(0);
#define N 500002
using namespace std;
int n,m,dfn[N],low[N],es = 1,stk_in[N],vertex_val[N],deg[N];
//dfnç‚ºæ™‚é–“æˆ³è¨˜,lowç‚ºback, cross edgeï¼ˆç¶“éæœ€å¤šä¸€æ¬¡ï¼‰åˆ°é”æœ€å°é»dfn,stk_inæ˜¯å¦åœ¨stackå…§
bool visit[N];
int scc[N],scc_ind = 0,scc_val[N];//ç´€éŒ„å±¬æ–¼å“ªå€‹scc,sccç·¨è™Ÿ,sccç·¨è™Ÿçš„åƒ¹å€¼ï¼ˆæ¬Šé‡å’Œï¼‰
int topological_order[N],ind = 0;

struct edg{
    int to;
    int val;
};

vector<edg> edge[N],new_edge[N];
stack<int> s;

void DFS(int now){
    dfn[now] = low[now] = es++;
    s.push(now);
    stk_in[now] = 1;
    visit[now] = 1;
    int len = edge[now].size();
    for(int i=0;i<len;i++){
        int next = edge[now][i].to;
        if(!visit[next]){       //å°šæœªæ‹œè¨ªå‰‡æ‹œè¨ª
            DFS(next);
            low[now] = min(low[now],low[next]);
        }
        else if(stk_in[next]){  //åœ¨stkå…§ä¸”å·²æ‹œè¨ª->åŒå±¬ä¸€å€‹SCC
            low[now] = min(low[now],dfn[next]);
            //é€™æ¢é‚ŠæŒ‡å‘é‚„æ²’å‡ºstackçš„é»ï¼Œå¯ç‚ºcross or back edge æ›´æ–°low[now]
        }
    }
    //å¦‚æœæ˜¯sccå°±pop stackè£¡é¢çš„æ±è¥¿
    if(low[now] == dfn[now]){
        stk_in[now] = 0;        //popå‡ºstackè£¡é¢
        scc[now] = ++scc_ind;   //é€²è¡ŒSCCç·¨è™Ÿ
        scc_val[scc_ind] = vertex_val[now]; //æ›´æ–°é»æ¬Š
        while(s.top()!=now){                //popç›´åˆ°nowè¢«æ‰¾åˆ°
            scc[s.top()] = scc_ind;
            stk_in[s.top()] = 0;            //popå‡ºä¾†
            scc_val[scc_ind] += vertex_val[s.top()];
            s.pop();
        }
        s.pop();//å°‡stack ä¸­nowä¹Ÿpop
    }
}

signed main(){
    ios;
    cin>>n>>m;
    memset(visit, 0, sizeof(visit));
    memset(stk_in, 0, sizeof(stk_in));
    memset(deg, 0, sizeof(deg));
    for(int i=1;i<=n;i++){
        int x;cin>>x;
        vertex_val[i] = x;
    }
    for(int i=0;i<m;i++){
        int x,y,val;cin>>x>>y>>val;//xæŒ‡å‘y
        edge[x].push_back( edg{y,val} );
    }
    for(int i=1;i<=n;i++)
        if(!visit[i])DFS(i);
    
    //æšèˆ‰æ¯ä¸€æ¢é‚Šæ›´æ–°é‚Šæ¬Š
    for(int i=1;i<=n;i++){
        int len = edge[i].size();
        for(int j=0;j<len;j++){
            int to = edge[i][j].to;
            if(scc[to]==scc[i]){
                int ind = scc[to];
                scc_val[ind]+=edge[i][j].val;
            }
            else{   //ä¸åŒSCCæŒ‡å‘ä¸åŒçš„é‚Š
                new_edge[scc[i]].push_back( edg{scc[to],edge[i][j].val});
                deg[scc[to]]++;
            }
        }
    }
    
    //Topological sort
    queue<int> q;
    
    for(int i=1;i<=scc_ind;i++)
        if(deg[i]==0)q.push(i);

    while(!q.empty()){
        int now = q.front(),len = new_edge[now].size();
        topological_order[ind++] = now;
        q.pop();
        for(int i=0;i<len;i++){
            int next = new_edge[now][i].to;
            if(--deg[next]==0)q.push(next);
        }
    }
    
    //æ‹“å¢£æ’åºå®Œé€²è¡ŒDPæ‰¾æœ€é•·è·¯å¾‘
    int dp[ind],ans = 0;
    for(int i=1;i<=scc_ind;i++){
        dp[i] = scc_val[i];
        ans = max(ans, scc_val[i]);
    }
    
    for(int i=0;i<ind;i++){
        int now = topological_order[i],len = new_edge[now].size();
        for(int j=0;j<len;j++){
            int next = new_edge[now][j].to;
            dp[next] = max(dp[next],scc_val[next]+dp[now]+new_edge[now][j].val);
            ans = max(ans, dp[next]);
        }
    }
    cout<<ans<<endl;
}
```

## æ‰‹å¯«ä½œæ¥­

ä»‹ç´¹é›œæ¹Šï¼Œé‡é»åœ¨æ–¼rolling hashï¼Œé€™ä¹Ÿæ˜¯ä¸‹ä¸€é€±éš¨æ©Ÿèª²ç¨‹ç•¶ä¸­æœƒç”¨åˆ°çš„é‡è¦æ¦‚å¿µã€‚

# è³‡èŠ½ç¬¬åäºŒé€±ï¼šéš¨æ©Ÿç®—æ³•

## ä¸Šèª²å…§å®¹

é€™ä¸€é€±è¬›éš¨æ©Ÿï¼Œä¸»è¦è¬›rolling hashï¼Œå­—ä¸²çš„hashã€éš¨æ©Ÿçš„ä¾‹é¡Œï¼Œåƒæ˜¯çŸ©é™£ä¹˜æ³•çš„é©—è­‰$O(n^2)$ã€è¨ªå•å€é–“å„å…ƒç´ å‡ºç¾æ¬¡æ•¸æ˜¯å¦ç‚ºkçš„å€æ•¸ï¼Œæœ€è¿‘é»å°çš„$O(n)$ä½œæ³•ç­‰ï¼ˆé‚„æœ‰æ±è¥¿é‚„æ²’æœ‰çœ‹XDï¼‰

## ä¸Šæ©Ÿä½œæ¥­

### æ¬¸è¿ªçš„å­—ä¸²

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/265/)
è¼¸å…¥æœ‰å…©è¡Œï¼Œç¬¬ä¸€è¡ŒåŒ…å«ä¸€å€‹é•·åº¦ä»‹æ–¼[1,500000]çš„å­—ä¸²Sï¼Œç¬¬äºŒè¡ŒåŒ…å«ä¸€å€‹é•·åº¦ä»‹æ–¼[1,500000]çš„å­—ä¸²Tï¼Œè«‹è¼¸å‡ºä¸€ä¸²éå¢çš„æ•¸åˆ—è¡¨ç¤ºå­—ä¸²Så‡ºç¾åœ¨å­—ä¸²Tçš„å“ªäº›åœ°æ–¹ã€‚

**Rolling hash**ï¼š
$$H(s[1:n]) = \sum_{i=0}^n S_i\times C^{n-i}$$
æˆ‘å€‘å¦‚æœå‡è¨­æˆ‘å€‘è¦æ‰¾çš„ç›®æ¨™å­—ä¸²Sï¼Œé•·åº¦ç‚ºmï¼Œä»–çš„é›œæ¹Šå€¼æ˜¯ï¼š
$$H(S)= \sum_{i=1}^mS_i \times C^{m-i}$$
å‰‡å°æ–¼é•·åº¦ç‚ºLèˆ‡r-1çš„å­—ä¸²Tï¼Œå…¶hashå€¼ç‚ºï¼š
$$H(T[1:L]) = \sum_{i=1}^LT_i\times C^{L-i}$$
$$H(T[1:r-1]) = \sum_{i=1}^{r-1}T_i\times C^{r-1-i}$$
å‰‡ç›®æ¨™å€é–“é•·åº¦ç‚ºmçš„å­—ä¸²é•·åº¦å³ç‚ºå­—ä¸²Sçš„é›œæ¹Šå€¼ï¼Œå°‡T[1:L]çš„é›œæ¹Šå€¼æ‰£æ‰$C^{m}$ä¹˜ä¸ŠT[1:r-1]çš„é›œæ¹Šå€¼ï¼Œå³ç‚ºæ‰€æ±‚ã€‚

$$\begin{split}H(S)&=H(T[r:L])\\ &=H(T[1:L])-H(T[1:r-1])\\
&= \sum_{i=1}^LT_i\times C^{L-i} - C^{m}\times \sum_{i=1}^{r-1}T_i\times C^{r-1-i} \\
&=\sum_{i=1}^LT_i\times C^{L-i}-\sum_{i=1}^{r-1}T_i\times C^{L-i} \\
&= \sum_{i=r}^{L}T_i\times C^{L-i} \\
&= \sum_{i=1}^{m}T_{i+r-1}\times C^{m-1}\end{split}$$
å°±å¯ä»¥å¾—åˆ°ç•¶å‰å€é–“çš„hashå€¼
æ‰€ä»¥é€™æ•´é¡Œå°±è®Šæˆç¶­è­·å­—ä¸²Tçš„å‰ç¶´å’Œï¼Œé€éä»¥ä¸Šæ–¹å¼O(n)å¾—åˆ°æ¯ä¸€å€‹indexçš„hashå€¼ï¼Œæ¥è‘—O(1)æ¯”å°å³å¯ã€‚
{% note success %}
Q:ç…§æœ€åŸºæœ¬çš„æš´åŠ›æ¯”å°å¯ä¸å¯è¡Œï¼Ÿ
A:å¯ä»¥æ§‹é€ å‡ºéœ€è¦æ¯”å°å¾ˆå¤šæ¬¡çš„å­—ä¸²ï¼Œæœ‰å¯èƒ½æœƒè¢«å¡TLEä¹‹é¡çš„
{% endnote %}
ä»¥å¾Œä¸€å®šè¦è¨˜å¾—ï¼Œå¿…é ˆè¦è¡Œæœ«**è¼¸å‡ºä¸€è¡Œ**ï¼Œæˆ‘åœ¨é€™é‚ŠWAè¶…ä¹…

```cpp=
#include <bits/stdc++.h>
#define int unsigned long long int
#define INF 0x3f3f3f3f
#define N 500005
#define mod 1000000007
using namespace std;
int power[N],hash_func[N],charc[30],n,m,C = 137;
char target[N],a[N];
vector<int> vec;

void init(){
    power[0] = 1;
    srand(time(NULL));
    for(int i=1;i<=m;i++){
        power[i] = ((power[i-1]*C)+mod)%mod;
    }
    for(int i=0;i<30;i++){    //å†ç”¨randä¾†ä½¿å­—ä¸²æ›´äº‚ï¼ˆä¸ç”¨ä¹Ÿæ²’å·®ï¼‰
        int temp = rand();
        charc[i] = temp;
    }
}
signed main(){
    scanf("%s\n%s",target+1,a+1);
    m = strlen(target+1);
    n = strlen(a+1);
    init();
    hash_func[0] = 0;
    
    for(int i=1;i<=n;i++){
        hash_func[i] = ((C*hash_func[i-1]+(charc[a[i]-'a']))+mod)%mod;
    }
    int sum = 0;
    for(int i=1;i<=m;i++){
        sum = ((sum*C+(charc[target[i]-'a']))+mod)%mod;
    }
    for(int i=0;i<=n-m;i++){
        if(sum == ((hash_func[i+m]-((hash_func[i]*power[m])+mod)%mod)+mod)%mod)
            vec.push_back(i);
    }
    int len = vec.size();
    
    if(len>0)printf("%llu",vec[0]);
    for(int i=1;i<len;i++){
        printf(" %llu",vec[i]);
    }
    cout<<endl;    //é€™ä¸€è¡Œæ˜¯æ¯’ç˜¤
}
```

### æº«åŠ›çš„æ•…äº‹

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/266/)
çµ¦å­—ä¸²é›†åˆAï¼Œæ¥ä¸‹ä¾†çµ¦må€‹å­—ä¸²ï¼Œå•ä½ åœ¨må€‹å­—ä¸²ä¸­iå­—ä¸²ä¸€å…±å‡ºç¾äº†å¹¾æ¬¡ã€‚
ç›´è¦ºçš„æƒ³æ³•å°±æ˜¯ç›´æ¥ç”¨multisetä¾†è§£é€™ä¸€é¡Œã€‚

```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define int unsigned long long int
#define N 105
using namespace std;
int n,m,power[N],C = 13331;

void init(){
    power[0] = 1;
    for(int i=1;i<=N;i++){
        power[i] = power[i-1]*C;
    }
}

int func(string s){
    int len = s.size(),sum = 0;
    for(int i=1;i<=len;i++){
        sum+=((int)s[i-1]*power[len-i]);
    }
    return sum;
}

signed main(){
    ios;
    init();
    multiset<int> ss;
    cin>>n>>m;
    for(int i=0;i<n;i++){
        string s;cin>>s;
        int temp = func(s);
        ss.insert(temp);
    }
    for(int i=0;i<m;i++){
        string s;cin>>s;
        int temp = func(s);
        cout<<ss.count(temp)<<endl;
    }
}
```

### æƒ³ä¸åˆ°é¡Œç›®æ¨™é¡ŒQQ

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/793/)
åœ–ä¸­çš„-2æ”¹æˆ-(k-1)ï¼Œå°æ–¼åœ–ä¸­çš„x,yéƒ½æ˜¯è¨­è¨ˆæˆå¤§æ•¸äº‚æ•¸ï¼Œè¦æ‰¿æ“”çš„é¢¨éšªå°±æ˜¯é€™äº›å¤§æ•¸ç›¸åŠ ä¹‹å¾Œä¸æ‡‰è©²è®Šæˆ0çš„å»è®Šæˆ0ï¼ˆæ©Ÿç‡è¶…å°ï¼‰
é‚„æœ‰ä¸€å€‹é‡é»ï¼Œå°æ–¼æ¯ä¸€ç­†è©¢å•éƒ½è¦æ±‚å‡ºå€é–“çš„å’Œï¼Œå› æ­¤è¦ç”¨O(n)ç¶­è­·å‰ç¶´å’Œï¼ï¼ˆä¸€é–‹å§‹æ²’æƒ³åˆ°tleï¼Œä¸ééˆå…‰ä¸€é–ƒç¶­è­·å‰ç¶´å’Œå°±éäº†ï¼‰
![](https://i.imgur.com/Z4NzA4J.png)

```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define int long long int
#define N 500005
#define mod 1000000007
using namespace std;
int n,k,m,arr[N],times[N],fuck[N],value[N],pre[N];

void init(){
    memset(times, 0, sizeof(times));
    srand(time(NULL));
    pre[0] = 0;
    for(int i=0;i<=N;i++){
        int temp = rand()%mod;
        fuck[i] = temp;
    }
}

signed main(){
    ios;
    init();
    cin>>n>>k>>m;
    for(int i=1;i<=n;i++){
        cin>>arr[i];
        times[arr[i]]++;
        if(times[arr[i]]%k==0){
            value[i] = -(k-1)*fuck[arr[i]];
        }
        else{
            value[i] = fuck[arr[i]];
        }
        pre[i] = (pre[i-1]+value[i]);
    }

    for(int i=1;i<=m;i++){
        int l,r,sum=0;cin>>l>>r;
        sum = pre[r]-pre[l-1];
        if(sum==0)cout<<1;
        else cout<<0;
    }
    cout<<endl;
}
```

### çŸ©é™£ä¹˜æ³•

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/740/)
çµ¦å®šä¸‰å€‹çŸ©é™£ABCï¼Œé©—è­‰Aä¹˜ä¸ŠBæ˜¯å¦ç‚ºCã€‚
ç•¶ç„¶å¯ä»¥ç”¨$O(n^3)$çš„æ™‚é–“å¯¦éš›é©—è­‰Aä¹˜ä¸ŠBçš„çµæœèˆ‡Cæ¯”å°ï¼Œä½†å…¶å¯¦æœ‰æ›´å¿«çš„æ–¹æ³•
å¦‚ä¸‹ï¼Œæ§‹é€ å‡ºçŸ©é™£Rï¼Œé€™ä¸€é¡Œå¯ä»¥æ€è€ƒè¦1ä¹˜ä¸Šå¤šå°‘çš„çŸ©é™£ï¼Œé€éå…©æ¬¡O(n^2)çš„ä¹˜æ³•ï¼Œå°±å¯ä»¥æ¯”å°é€™å€‹RçŸ©é™£ä¹˜ä¸ŠCçŸ©é™£çš„çµæœ
é€™é¡Œè »ç°¡å–®çš„ï¼Œä¸€æ¬¡å°±éäº†

```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define int long long int
#define N 1505
#define mod 1000000007
using namespace std;
int n,m,k,a[N][N],b[N][N],c[N][N],R[N],temp[N],c_new[N];

void init(){
    memset(temp, 0, sizeof(temp));
    srand(time(NULL));
    for(int i=0;i<N;i++){
        int temp = rand()%mod;
        R[i] = temp;
    }
}

void input(){
    cin>>n>>m>>k;
    for(int i=0;i<n;i++){
        for(int j=0;j<m;j++){
            cin>>a[i][j];
        }
    }
    for(int i=0;i<m;i++){
        for(int j=0;j<k;j++){
            cin>>b[i][j];
        }
    }
    for(int i=0;i<n;i++){
        for(int j=0;j<k;j++){
            cin>>c[i][j];
        }
    }
}

signed main(){
    ios;
    init();
    input();
    for(int i=0;i<m;i++){
        for(int j=0;j<k;j++){
            temp[i]+=(b[i][j]*R[j])%mod;
        }
    }
    for(int i=0;i<n;i++){
        for(int j=0;j<m;j++){
            c_new[i]+=(a[i][j]*temp[j])%mod;
        }
    }
    bool flag = 1;
    for(int i=0;i<n;i++){
        int sum = 0;
        for(int j=0;j<k;j++){
            sum+=(c[i][j]*R[j])%mod;
        }
        if(c_new[i]!=sum){
            flag = 0;
            break;
        }
    }
    if(flag)cout<<"Yes"<<endl;
    else cout<<"No"<<endl;
}
```

### æœ€è¿‘é»å°

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/795/)
å¤§é­”ç‹é¡Œï¼Œå®³æˆ‘TLE 27æ¬¡ã€‚
äºŒç¶­å¹³é¢ï¼Œçµ¦å®šnå€‹é»ï¼Œæ±‚å‡ºæœ€è¿‘çš„å…©å€‹é»çš„è·é›¢ã€‚
é‡å¤§BUGå®³æˆ‘å¡ä¸‰å¤©çš„BUGåœ¨æ–¼ï¼Œé¡Œç›®è¦æ±‚è¼¸å‡ºè·é›¢çš„å¹³æ–¹ï¼Œçµæœåœ¨è¨ˆç®—éç¨‹ä¸­å°±ç›´æ¥æŠŠè·é›¢ç•¶ä½œæ˜¯å¹³æ–¹ï¼Œè‡ªç„¶æœ‰å¾ˆå¤šé»æœƒåŒæ™‚å‡ºç¾åœ¨ä¸€æ ¼ç¶²æ ¼åº§æ¨™ä¸­ï¼ˆæˆ‘å¼±ï¼Œä¸€ç›´TLEï¼‰ï¼Œé‚„ä¸€ç›´ç”¨ä»€éº¼multi_mapä¹‹é¡çš„ï¼Œç•¶ç„¶å°±æ˜¯TLEå˜ã€‚
æš´åŠ›åšï¼š$O(n^2)$ï¼Œåˆ†æ²»åšï¼š$O(nlogn)$ï¼Œéš¨æ©Ÿåšï¼šæœŸæœ›$O(n)$,æœ€æ…˜$O(n^2)$
é€™ä¸€é¡Œçš„æ­¥é©Ÿï¼š

1. æŠŠ N å€‹é»å¹³ç§»åˆ°ç¬¬ä¸€è±¡é™
2. æŠŠ N å€‹é»çš„é †åºéš¨æ©Ÿæ‰“äº‚ï¼Œd = dis(ğ‘1, ğ‘2)
3. ä»¥ ğ‘Ÿ = ğ‘‘/2 çš„å¤§å°å°‡äºŒç¶­å¹³é¢åˆ‡æˆç¶²æ ¼ç‹€ï¼Œä¸¦å°‡é€™äº›ç¶²æ ¼ä¹Ÿ ğ‘¥ğ‘¦
ä»¥åº§æ¨™è¡¨ç¤º:é»(ğ‘¥,ğ‘¦)æœƒè½å…¥åº§æ¨™ç‚º (ğ‘Ÿ,ğ‘Ÿ)
<font color="#f00">ä¸æœƒæœ‰å…©å€‹é»åœ¨åŒä¸€å€‹æ ¼å­å…§</font>ï¼ˆå¾ˆé‡è¦çš„æ€§è³ªï¼‰
4. ä¸€ç›´æŠŠé»åŠ é€²ç¶²æ ¼ä¸­
å¦‚æœç”¢ç”Ÿæ–°çš„æœ€è¿‘é»å°ä¸€å®šæœƒå‡ºç¾åœ¨ä»¥æŸå€‹é»ç‚ºä¸­å¿ƒçš„5Ã—5å®®æ ¼å…§
5. æ‰¾åˆ°æ›´è¿‘çš„æœ€è¿‘é»å°
æ›´æ–° r= æ–°çš„æœ€è¿‘é»å° /2 ï¼Œå›åˆ°æ­¥é©Ÿä¸‰é‡ä¾† O(i+1)

{% note info %}
**æœŸæœ›è¤‡é›œåº¦ $O(n)$ è­‰æ˜**

è€ƒæ…®åŠ å…¥ç¬¬i+1å€‹é»æ™‚å‡ºç¾æ–°çš„æœ€è¿‘é»å°ï¼Œç™¼ç”Ÿçš„æ©Ÿç‡ç‚ºï¼šåœ¨$C_2^{i+1}$å€‹é…å°ä¸­è·Ÿi+1å€‹é»ç”¢ç”Ÿæœ€è¿‘é»å°å…±æœ‰iç¨®å¯èƒ½ï¼Œå› æ­¤æ©Ÿç‡ç‚º$\frac{2}{i+1}$ï¼Œç•¶æ©Ÿç‡ç™¼ç”Ÿçš„æ™‚å€™ï¼Œå¿…é ˆå°‡æ‰€æœ‰çš„é»éƒ½åˆªæ‰é‡æ–°ä¾†ä¸€éï¼ˆå› ç‚ºrè®Šå°ï¼Œunordered_mapè£¡é¢çš„æ±è¥¿ä¹Ÿè¦è¢«æ¸…ç©ºï¼Œé‡æ–°æ¨å…¥i+1å€‹é»ï¼‰ï¼Œéœ€è¦ä»˜å‡º$O(i+1)$çš„æ™‚é–“ï¼Œç›¸ä¹˜èµ·ä¾†æ¯ä¸€å€‹é»æœŸæœ›çš„è¤‡é›œåº¦ç‚º$O(1)$ï¼Œå› æ­¤ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º$O(n)$ã€‚
{% endnote %}

å¯¦ä½œä¸Šå¯ä»¥ç”¨unordered_mapï¼Œå› ç‚ºä¿è­‰ä¸æœƒå‡ºç¾åŒä¸€æ ¼çš„æƒ…æ³ï¼ˆä¸€æ ¼é–“çš„æœ€é•·è·é›¢ä¹Ÿå°±ä¸è¶…édï¼Œæ‰€ä»¥ç•¶å‡ºç¾åœ¨åŒä¸€æ ¼å°±è¡¨ç¤ºè©²æ›´æ–°äº†ï¼‰

å„ªåŒ–ï¼šå…ˆç”¨$O(n^2)$çš„ä½œæ³•ï¼Œæ‰¾åˆ°å‰é¢çš„å°‘æ•¸pairï¼ˆ$\sqrt n$ï¼‰çš„æœ€çŸ­è·é›¢ï¼Œé€™æ¨£å¯ä»¥æ¸›å°‘è¢«é‡æ–°æ›´æ–°çš„æ©Ÿæœƒ
![](https://i.imgur.com/9XfZNH9.png)

[é€™ç¯‡æ–‡ç« ](/N9zvIzP_Se-hpWZSaMv-sQ)æœ‰åˆ†æ²»çš„ä½œæ³•ï¼Œé›–ç„¶åˆ†æ²»çš„è¤‡é›œåº¦æ˜¯O(n\log n)ï¼Œéš¨æ©Ÿæ˜¯$O(n)$ï¼Œä½†å› ç‚ºéš¨æ©Ÿå¸¸æ•¸æ¯”è¼ƒå¤§çš„é—œä¿‚ï¼Œæ™‚é–“æ¯”åˆ†æ²»æ…¢äº†å¿«å…©å€ï¼ä¸‹åœ–æ˜¯åˆ†æ²»çš„åŸ·è¡Œçµæœï¼š
![](https://i.imgur.com/eCxfumY.png)

ä»¥ä¸‹æ˜¯éš¨æ©ŸAC Codeï¼š

```cpp=
#include <bits/stdc++.h>
#define int long long int
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define N 200005
#define INF 1000000000LL
#define swift 1000000000
using namespace std;
int n,ans;
double r,d;
int dx[25] = {-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,0,0,0,0,0,1,1,1,1,1,2,2,2,2,2};
int dy[25] = {-2,-1,0,1,2,-2,-1,0,1,2,-2,-1,0,1,2,-2,-1,0,1,2,-2,-1,0,1,2};
unordered_map<int, int> m;

void solve();
inline void init();
void solve();
bool insert(int,int,int);
inline double dis(int,int);
inline int Grid(int);

struct node{
    int x,y,ind;
}point[N];

//å‡½å¼å¯¦ä½œ
inline void init(){
    m.clear();
}

inline int Grid(int ind){ //inputç¶²æ ¼åº§æ¨™
    int x = point[ind].x/r;
    int y = point[ind].y/r;
    return x*INF+y;
}
inline int dist(node a,node b){
    int x = a.x-b.x,y = a.y-b.y;
    return (x*x+y*y);
}

inline double dis(node a,node b){
    int x = a.x-b.x,y = a.y-b.y;
    return sqrt(x*x+y*y);
}

void solve(){
    m.insert(make_pair(Grid(0),0));m.insert(make_pair(Grid(1),1));
    for(int ind = 2;ind < n;ind++){
        int x = point[ind].x/r,y = point[ind].y/r,better=0;
        for(int i=0;i<25;i++){
            int nx = x+dx[i],ny = y+dy[i];
            auto it = m.find(nx*INF+ny);
            if(it!=m.end()){
                double distance = dis(point[it->second],point[ind]);
                if(distance<d){
                    better = 1;
                    ans = dist(point[it->second],point[ind]);
                    d = distance;
                    r = d/2;
                }
            }
        }
        if(better){    //å‰é¢çš„æ ¼å­ç›´æ¥ç‘±å…¥
            m.clear();
            for(int i=0;i<=ind;i++)m.insert(make_pair(Grid(i),i));
        }
        else{
            m.insert(make_pair(Grid(ind), ind));
        }
    }
}

signed main(){
    ios;
    init();
    cin>>n;
    for(int i=0;i<n;i++){
        int x,y;cin>>x>>y;
        x+=swift;y+=swift;
        point[i].x = x;point[i].y = y;
    }
    random_shuffle(point, point+n);
    int smalln = sqrt(n);
    ans = dist(point[0],point[1]);
    d = dis(point[0], point[1]);
    for(int i=0;i<=smalln;i++){
        for(int j=i+1;j<=smalln;j++){
            d = min(d,dis(point[i], point[j]));
            ans = min(ans,dist(point[i],point[j]));
        }
    }
    r = d/2;
    solve();
    cout<<ans<<endl;
}
```

## æ‰‹å¯«ä½œæ¥­

ä¸ç”¨äº¤æ‰‹å¯«ä½œæ¥­ï¼ä¸éé‚„æ˜¯æœ‰ä¸€ä»½ã€Œæ¬£è³ç”¨ã€çš„ï¼Œè¬›Disjoint Set

# è³‡èŠ½ç¬¬åä¸‰é€±ï¼šæ ¹è™Ÿç®—æ³•

## ä¸Šèª²å…§å®¹

å¥½å™å¿ƒå–”ï¼Œè¤‡é›œåº¦ç«Ÿç„¶å¸¶æ ¹è™Ÿï¼ï¼Ÿ æ ¹è™Ÿç®—æ³•æœ‰å¾ˆå¤šä¾‹é¡Œï¼Œæœ€å¸¸è½åˆ°ï¼ˆæˆ–é‡åˆ°ï¼Ÿï¼‰çš„å°±æ˜¯**åˆ†å¡Š**äº†ï¼æŠŠåºåˆ—åˆ†æˆ$\sqrt{K}$ å¡Šï¼Œåœ¨åšRMQï¼ˆå€é–“åŠ å€¼ã€å€é–“æ±‚å’Œç­‰ï¼‰çš„å…¶ä¸­ä¸€ç¨®æ–¹å¼

1. RMQå€é–“æ¥µå€¼è©¢å•ï¼ˆå¯ä»¥ç”¨åˆ†å¡Šåšã€ç·šæ®µæ¨¹ã€BITã€ç¨€ç–è¡¨sparse tableï¼‰
2. Counting Triangle
3. åˆ†å¡Šï¼ˆå€¼åŸŸåˆ†å¡Šã€å¡Šç‹€éŠè¡¨ç­‰ï¼‰
4. **æ“ä½œåˆ†å¡Š**

å…¶å¯¦æ ¹è™Ÿç®—æ³•çš„é‡é»å…¶å¯¦åœ¨æ–¼è¤‡é›œåº¦åˆ†æï¼ˆè¬›å¸«èŠ±å¾ˆå¤šæ™‚é–“è¬›ä¸åŒä½œæ³•çš„è¤‡é›œåº¦åˆ†æï¼‰ï¼Œæ€éº¼æ¨£åˆ†æè®“è¤‡é›œåº¦è·‘å‡ºæ ¹è™Ÿ

## ä¸Šæ©Ÿä½œæ¥­

### Counting Triangles

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/252/)
æˆ‘å€‹äººèªç‚ºåšæ³•è¶…ç´šç²¾å¦™çš„ï¼æœ‰å¾ˆå¤šç¨®ä½œæ³•ï¼ŒæŒ‘ä¸€å€‹æ¯”è¼ƒå¥½å¯¦ä½œçš„ï¼š
{% note success %}
å‡è¨­å¯ä»¥ $O(1)$ å›ç­” (x, y) æ˜¯å¦ç‚ºåœ–ä¸­çš„ä¸€å€‹é‚Šã€‚å°æ–¼æ¯æ¢é‚Š (u, v) ï¼Œä½ èŠ±$O(min(d_u, d_v))$å»ç®—å‡ºåŒ…å«é€™æ¢é‚Šçš„ä¸‰è§’å½¢å€‹æ•¸
ç¸½è¤‡é›œåº¦ï¼š$O(M\sqrt{M})$
{% endnote %}

å…¶ä¸­å°æ–¼å‡æ”¤æŸ¥è©¢ä¸€æ¢é‚Šæœ‰æ²’æœ‰åœ¨åœ–ä¸­ï¼Œç¸½é‚Šæ•¸$O(M)$ $\div$ è©¢å•æ¯ä¸€æ¢é‚Š$O(M)$ = å‡æ”¤$O(1)$çš„è¤‡é›œåº¦ï¼Œå¯¦ä½œèµ·ä¾†éå¸¸ç°¡å–®

```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define N 100001
#define M 100001
using namespace std;

int main(){
    ios;
    vector<int> G[N],query[N];  //Gæ˜¯å­˜åœ–ã€queryæ˜¯å­˜è©¢å•
    int n,m,x[M],y[M];  //x,yå­˜é‚Šç”¨
    bool visit[N];
    
    cin>>n>>m;
    for(int i=0;i<m;i++){
        cin>>x[i]>>y[i];
        G[x[i]].push_back(y[i]);
        G[y[i]].push_back(x[i]);
    }
    int sml = 0,big = 0;
    for(int i=0;i<m;i++){    //ä¿è­‰è¤‡é›œåº¦ç‚ºæ ¹è™Ÿçš„é—œéµ
        if(G[x[i]].size()<=G[y[i]].size())sml = x[i];
        else sml = y[i];    //å°‹æ‰¾å“ªä¸€å€‹åº¦æ•¸æ¯”è¼ƒå°
        big = x[i]+y[i]-sml;
        for(int j : G[sml]){   //è¨ªå•è·Ÿsmlæœ‰ç›¸é„°çš„æ‰€æœ‰é‚Šï¼Œçœ‹æœ‰æ²’æœ‰(j,big)
            query[j].push_back(big);
        }
    }
    int ans = 0;
    for(int i=0;i<n;i++){
        //å‡æ”¤O(1)?
        for(int j:G[i]){
            visit[j] = true;
        }
        for(int j:query[i]){
            ans+=visit[j];
        }
        for(int j:G[i]){
            visit[j] = false;
        }
    }
    cout<<ans/3<<endl;
}
```

### ä¸­åœ‹äººæ’éšŠå•é¡Œ

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/213/)
å¦‚æœç”¨ä¸€å€‹vector å­˜æ•´å€‹åºåˆ—ï¼Œquery $O(1)$ï¼Œä½†æ–°å¢è·Ÿåˆªé™¤éƒ½æ˜¯$O(N)$
å› æ­¤ï¼Œå¦‚æœæ”¹ç”¨åˆ†å¡Šçš„æ–¹æ³•ï¼Œç”¨dequeä¸‹å»ç ¸ï¼Œæ¯Kå€‹åˆ†æˆä¸€å¡Šï¼Œå°æ–¼æ’å…¥èˆ‡åˆªé™¤éƒ½æ˜¯$O(K+\frac{N}{K})$ï¼Œè©¢å•æ˜¯$O(1)$
æ ¹æ“šç®—å¹¾ä¸ç­‰å¼ï¼Œæˆ‘å€‘å¯ä»¥å–$K = \sqrt{N}$ æ™‚ï¼Œè¤‡é›œåº¦å¯ä»¥é”åˆ°$O(\sqrt{N})$ ï¼Œå¾ˆä¸éŒ¯å§ï¼

```cpp=
#include <bits/stdc++.h>
#define ios ios::sync_with_stdio(0),cin.tie(0)
using namespace std;

signed main(){
    ios;
    int n,m,K;
    cin>>n>>m;
    K = sqrt(n);
    deque<int> deq[n/K+(m/K)+10];
    for(int i=0;i<n;i++){
        int temp;cin>>temp;
        deq[i/K].push_back(temp);
    }
    for(int i=0;i<m;i++){
        string a;cin>>a;
        if(a[0]=='A'){
            int x,y;cin>>y>>x;y--;
            deq[y/K].insert(deq[y/K].begin()+(y%K), x);
            int len = deq[y/K].size(),cur = y/K;
            while(len>K){
                int temp = deq[cur].back();
                deq[cur].pop_back();
                cur++;
                deq[cur].push_front(temp);
                len = deq[cur].size();
            }
        }
        else if(a[0]=='L'){
            int x;cin>>x;x--;
            deq[x/K].erase(deq[x/K].begin()+(x%K));
            int len = deq[x/K].size(),cur = x/K;
            while(len<K && deq[cur+1].size()!=0){
                int temp = deq[cur+1].front();
                deq[cur+1].pop_front();
                deq[cur].push_back(temp);
                cur++;
                len = deq[cur].size();
            }
        }
        else if(a[0]=='Q'){
            int x;cin>>x;x--;
            int len = x%K;
            auto it = deq[x/K].begin();
            cout<<*(it+len)<<endl;
        }
    }
}
```

### ç¬¬ Z å°

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/742/)
è¶…è¨å­ï¼Œä¸€ç›´REï¼Œçµæœæ˜¯å¡åœ¨æ²’æœ‰é–‹long longï¼Œå“­å•Š
é€™ä¸€é¡Œæ˜¯å€¼åŸŸåˆ†å¡Šï¼Œä¸€æ¨£æ˜¯æ ¹æ“šå€¼åŸŸæ¯Kå€‹åˆ†æˆä¸€å¡Šï¼Œå»ç¶­è­·æ¯ä¸€å¤§å¡Šçš„æ•¸å­—æ•¸é‡ç¸½å’Œï¼Œé€™æ¨£åœ¨æŸ¥è©¢(query)çš„æ™‚å€™èŠ± $O(C/K)$ æ‰¾åˆ°ç›¸æ‡‰å¤§å¡Š(Cç‚ºå€¼åŸŸ)ï¼Œå†èŠ± $O(K)$ çš„æ™‚é–“æƒéå°å¡Šï¼Œè€ŒåŠ å€¼æ¸›å€¼éƒ½æ˜¯$O(1)$å¯ä»¥è™•ç†
è¤‡é›œåº¦ï¼š$O(K+\frac{C}{K})$ å– K=$\sqrt{C}$ æœ‰æœ€å°å€¼ï¼š$O(Q\sqrt{C})$

```cpp=
#include <bits/stdc++.h>
#define int long long
#define ios ios::sync_with_stdio(0),cin.tie(0)
#define N 100005
using namespace std;    //å€¼åŸŸåˆ†å¡Š
const int K = 100;

signed main(){
    ios;
    int q,arr[N],mn[N/K+10];cin>>q;
    memset(arr, 0, sizeof(arr));
    while(q--){
        int temp;cin>>temp;
        if(temp==1){
            int x,y;cin>>x>>y;
            arr[x]+=y;
            mn[x/K]+=y;
        }
        else if(temp==2){
            int x,y;cin>>x>>y;
            arr[x]-=y;
            mn[x/K]-=y;
        }
        else if(temp==3){
            int z,sum = 0,ind=0;cin>>z; //indæŸ¥è©¢ä½æ–¼ç¬¬å¹¾å¡Š
            while(sum+mn[ind]<z)sum+=mn[ind++];
            int cur_ind = ind*K;
            for(int i=0;i<=K;i++){
                if(arr[cur_ind+i]){
                    sum+=arr[cur_ind+i];
                    if(sum>=z){
                        cout<<ind*K+i<<endl;
                        break;
                    }
                }
            }
        }
    }
}
```

### å°å’²çš„ç©å…·

[é¡Œç›®é€£çµ](https://neoj.sprout.tw/problem/722/)
é€™ä¸€é¡Œçš„å¸¸æ•¸è¶…ç·Šï¼Œå› æ­¤åœ¨å˜—è©¦ä½¿ç”¨*hash*æ™‚ç”¨*unordredmap*è¢«å¡*TLE*ï¼Œåœ¨å¾ˆé›»çš„äººæç¤ºå¾Œï¼Œè¦ä½¿ç”¨é»‘é­”æ³•cc_hash_tableæ‰å¯èƒ½æœƒéé—œ

```cpp=
#include <ext/pb_ds/assoc_container.hpp>
using namespace __gnu_pbds;
cc_hash_table<int,int>cc;
```

ä»–çš„ç”¨æ³•å…¶å¯¦è·Ÿ*unordered_map*å¹¾ä¹ä¸€æ¨£å§ï¼ˆè‡³å°‘åŸºæœ¬çš„insertè·Ÿfindçš„èªæ³•éƒ½ä¸€æ¨£ï¼‰ï¼Œä¸éä»–å¯ä»¥åšåˆ°æ¯”*unordered_map*æ›´å¥½çš„æ•ˆç‡ã€‚ä¸éæˆ‘ç”¨[æœ€è¿‘é»å°](https://neoj.sprout.tw/problem/795/)é€™ä¸€é¡Œæ¸¬è©¦æ•ˆç‡å»ç™¼ç¾é»‘é­”æ³•æœƒtleï¼Œå¯èƒ½æ˜¯åœ¨clearé€™ä¸€å€‹æ­¥é©Ÿçš„æ•ˆç‡ä¸¦ä¸æ˜¯å¾ˆå¥½å§ï¼

ç¸½ä¹‹ï¼Œå°±æ˜¯å°æ–¼æ¯ä¸€ç­†è©¢å•(x,y)ï¼Œä¸å¤±ä¸€èˆ¬æ€§å‡è¨­size_y > size_xï¼Œå‰‡å°æ–¼yæ’åºä¸¦é è™•ç†å‰ç¶´å’Œï¼ŒåŒæ™‚æšèˆ‰xä¸­çš„æ‰€æœ‰é»ä¸¦äºŒåˆ†æœä»–åœ¨yçš„ä½ç½®
æœ€é‡è¦çš„ï¼Œæ˜¯å°æ¯ä¸€ç­†è©¢å•éƒ½å„²å­˜èµ·ä¾†ï¼Œé€™æ¨£è¤‡é›œåº¦æœƒç¬é–“å°‘ä¸€å€‹N
**è£œè¤‡é›œåº¦è­‰æ˜**

```cpp=
#include <bits/stdc++.h>
using namespace std;
#include <ext/pb_ds/assoc_container.hpp>
using namespace __gnu_pbds;
#define int long long
#define N 150006

int n,k,q;
vector<int> vec[N],pre[N];
bool visit[N];
cc_hash_table<int,int>cc;
 
int HASH(int x,int y){
    return x*1000000007+y;
}
signed main(){
    scanf("%lld %lld %lld",&n,&k,&q);
    memset(visit, 0, sizeof(visit));
    while(k--){
        int c,p;scanf("%lld %lld",&c,&p);
        vec[p].push_back(c);
    }
    while(q--){
        int x,y;scanf("%lld %lld",&x,&y);
        if(vec[x].size()>vec[y].size())swap(x, y);
        
        if(cc.find(HASH(x,y))!=cc.end()){
            printf("%lld\n",cc.find(HASH(x,y))->second);
            continue;
        }
        else if(cc.find(HASH(y,x))!=cc.end()){
            printf("%lld\n",cc.find(HASH(y,x))->second);
            continue;
        }
        
        int len = vec[y].size();
        if(!visit[y]){
            sort(vec[y].begin(),vec[y].end());
            pre[y].resize(len+6);
            for(int i=0;i<=len;i++)pre[y][i+1] = pre[y][i]+vec[y][i];
            visit[y] = 1;
        }
        
        int ans = 0;
        for(int j:vec[x]){
            int pos = lower_bound(vec[y].begin(), vec[y].end(),j)-vec[y].begin();
            pos--;
            if(pos<0)ans+=(len*j);
            else ans += (pre[y][pos+1]+j*(len-pos-1));
        }
        printf("%lld\n",ans);
        cc.insert(make_pair(HASH(x,y),ans));
        cc.insert(make_pair(HASH(y,x),ans));
    }
}
```

## æ‰‹å¯«ä½œæ¥­

é€™å·²ç¶“æ˜¯æœ€å¾Œçš„ä¸€å ‚èª²äº†qqï¼Œ13é€±çš„èª²ç¨‹å°±é€™æ¨£çµæŸäº†ï¼
![](https://i.imgur.com/o8xCu1i.gif)
![](https://i.imgur.com/tevltPd.png)
æ‰‹å¯«ä½œæ¥­æ’å12ï¼Œä¸Šæ©Ÿä¸çŸ¥é“ï¼Œä½†äºŒéšæ®µå› ç‚ºå‰›å¥½äºŒæ®µçš„é—œä¿‚ï¼Œæœ‰ä¸€å€‹ç¦®æ‹œï¼ˆdp3ï¼‰çš„èª²çš„ä¸Šæ©Ÿä½œæ¥­å…¨éƒ¨æ”¾æ‰ï¼ˆæˆ‘åœ¨å¹¹å˜›qqï¼‰é‚£çœŸæ˜¯æ…˜å•Šï¼
